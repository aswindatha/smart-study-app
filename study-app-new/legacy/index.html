<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Learning Control Center</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            position: relative;
            overflow-x: hidden;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Floating Blobs */
        .blob {
            position: fixed;
            border-radius: 50%;
            filter: blur(40px);
            opacity: 0.3;
            animation: float 20s infinite ease-in-out;
            pointer-events: none;
        }

        .blob1 {
            width: 300px;
            height: 300px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            top: -150px;
            left: -150px;
            animation-delay: 0s;
        }

        .blob2 {
            width: 400px;
            height: 400px;
            background: linear-gradient(135deg, #f093fb, #f5576c);
            top: 50%;
            right: -200px;
            animation-delay: 5s;
        }

        .blob3 {
            width: 350px;
            height: 350px;
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            bottom: -175px;
            left: 30%;
            animation-delay: 10s;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -30px) rotate(120deg); }
            66% { transform: translate(-20px, 20px) rotate(240deg); }
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 30px 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            position: relative;
            z-index: 100;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .logo h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-actions {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .nav-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn.primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .nav-btn.logout {
            background: linear-gradient(135deg, #f5576c, #f093fb);
            color: white;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .nav-btn.secondary {
            background: rgba(255, 255, 255, 0.8);
            color: #333;
            backdrop-filter: blur(10px);
        }

        .nav-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-2px);
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 40px auto;
            padding: 0 40px;
        }

        /* Tab Navigation */
        .tab-navigation {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 10px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.1);
            margin-bottom: 40px;
            display: flex;
            gap: 10px;
            overflow-x: auto;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .tab-btn {
            padding: 15px 25px;
            border: none;
            background: transparent;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
        }

        .tab-btn:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .tab-icon {
            font-size: 1.2rem;
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Content Sections */
        .content-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .content-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #f5576c);
            background-size: 300% 100%;
            animation: gradientMove 3s ease infinite;
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }

        .section-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .section-header h2 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 15px;
        }

        .section-header p {
            font-size: 1.1rem;
            color: #666;
            line-height: 1.6;
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .form-card {
            background: rgba(0,0,0,0.03);
            border-radius: 20px;
            padding: 30px;
            transition: all 0.3s ease;
        }

        .form-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }

        .form-card h3 {
            font-size: 1.3rem;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid rgba(0,0,0,0.1);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Radio Button Groups */
        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 8px;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-weight: 500;
            margin-bottom: 0;
            padding: 8px 12px;
            border: 2px solid rgba(0,0,0,0.1);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .radio-group label:hover {
            border-color: #667eea;
            background-color: rgba(102, 126, 234, 0.05);
        }

        .radio-group input[type="radio"] {
            width: auto;
            margin: 0;
            cursor: pointer;
        }

        .radio-group input[type="radio"]:checked + label {
            border-color: #667eea;
            background-color: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .form-group small {
            display: block;
            margin-top: 5px;
            color: #666;
            font-size: 0.85rem;
        }

        /* Learning Hub Styles */
        .learning-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .notes-chat-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .section-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .section-card h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .course-placeholder, .notes-placeholder, .chat-placeholder {
            text-align: center;
            color: #666;
            padding: 40px;
            background: rgba(0,0,0,0.05);
            border-radius: 10px;
            border: 2px dashed rgba(0,0,0,0.1);
        }

        .camera-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .camera-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .metrics-display {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            background: rgba(102, 126, 234, 0.1);
            padding: 15px;
            border-radius: 10px;
        }

        .metric-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .metric-item:last-child {
            border-bottom: none;
        }

        .metric-label {
            font-weight: 500;
            color: #555;
        }

        .metric-value {
            font-weight: 600;
            color: #667eea;
        }

        .notes-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .chat-history {
            max-height: 250px;
            overflow-y: auto;
            margin-top: 15px;
            background: rgba(0,0,0,0.05);
            padding: 15px;
            border-radius: 10px;
        }

        .progress-display {
            margin-top: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            transition: width 0.5s ease;
        }

        .progress-text {
            font-weight: 600;
            color: #667eea;
        }

        @media (max-width: 968px) {
            .learning-grid {
                grid-template-columns: 1fr;
            }
            
            .notes-chat-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Student Dashboard Styles */
        .welcome-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }

        .welcome-content {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .welcome-avatar {
            font-size: 3rem;
            background: rgba(255,255,255,0.2);
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .welcome-info h3 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .welcome-info p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        .stat-icon {
            font-size: 2rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-content {
            flex: 1;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-weight: 500;
        }

        .courses-section {
            margin-bottom: 30px;
        }

        .courses-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .courses-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .course-item {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .course-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        .course-item h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .course-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .course-status {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .course-item p {
            color: #666;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .course-progress {
            background: rgba(0,0,0,0.1);
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .course-progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            transition: width 0.5s ease;
        }

        .course-progress-text {
            font-size: 0.8rem;
            color: #667eea;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .course-materials {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .material-tag {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .course-actions {
            margin-top: auto;
        }

        .course-action-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .course-action-btn.start {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .course-action-btn.continue {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }

        .course-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        @media (max-width: 768px) {
            .welcome-content {
                flex-direction: column;
                text-align: center;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .progress-form {
                flex-direction: column;
            }
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e, #38ef7d);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(17, 153, 142, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f5576c, #f093fb);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(245, 87, 108, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Response Area */
        .response-area {
            background: rgba(0,0,0,0.03);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            min-height: 100px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            border: 1px solid rgba(0,0,0,0.1);
        }

        .response-area.success {
            background: linear-gradient(135deg, rgba(212, 237, 218, 0.5), rgba(195, 230, 203, 0.5));
            border-color: #c3e6cb;
            color: #155724;
        }

        .response-area.error {
            background: linear-gradient(135deg, rgba(248, 215, 218, 0.5), rgba(245, 198, 203, 0.5));
            border-color: #f5c6cb;
            color: #721c24;
        }

        /* Video Container */
        .video-container {
            background: rgba(0,0,0,0.05);
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
        }

        #video-feed {
            width: 100%;
            max-width: 640px;
            height: 480px;
            background: #000;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .video-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Analytics Charts */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin: 30px 0;
        }

        .chart-card {
            background: rgba(0,0,0,0.03);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
        }

        .chart-card h4 {
            font-size: 1.2rem;
            color: #333;
            margin-bottom: 20px;
        }

        .chart-card canvas {
            max-width: 100%;
            height: 250px;
            border-radius: 10px;
        }

        /* Data Grid */
        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .data-card {
            background: rgba(255,255,255,0.8);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .data-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .data-card h4 {
            font-size: 1.3rem;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .data-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .data-item:last-child {
            border-bottom: none;
        }

        .data-label {
            color: #666;
            font-weight: 500;
        }

        .data-value {
            color: #333;
            font-weight: 600;
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(102, 126, 234, 0.1);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Status Indicators */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .status-indicator.online {
            background: linear-gradient(135deg, rgba(56, 239, 125, 0.2), rgba(17, 153, 142, 0.2));
            color: #11998e;
        }

        .status-indicator.offline {
            background: linear-gradient(135deg, rgba(245, 87, 108, 0.2), rgba(240, 147, 251, 0.2));
            color: #f5576c;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s infinite;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .logo h1 {
                font-size: 2rem;
            }

            .tab-navigation {
                flex-wrap: wrap;
                justify-content: center;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .data-grid {
                grid-template-columns: 1fr;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 0 20px;
            }

            .video-controls {
                flex-direction: column;
            }
        }

        /* Video Progress Styles */
        .video-progress-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .progress-header h4 {
            color: #333;
            margin: 0;
            font-size: 1.1rem;
        }

        .progress-info {
            display: flex;
            gap: 15px;
            align-items: center;
            font-size: 0.9rem;
            color: #666;
        }

        .progress-info span {
            font-weight: 600;
            color: #667eea;
        }

        .video-progress-bar {
            background: rgba(0,0,0,0.1);
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
            position: relative;
        }

        .video-progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        /* PDF Section Styles */
        .pdf-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .pdf-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .pdf-header h4 {
            color: #333;
            margin: 0;
            font-size: 1.1rem;
        }

        .pdf-actions {
            display: flex;
            gap: 10px;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.85rem;
            border-radius: 8px;
        }

        .pdf-container {
            border-radius: 10px;
            overflow: hidden;
            background: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* Teacher Navigation Bar */
        .teacher-navbar {
            display: flex;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 10px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            overflow-x: auto;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 15px 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            color: #666;
            font-weight: 500;
        }

        .nav-item:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            transform: translateY(-2px);
        }

        .nav-item.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .nav-icon {
            font-size: 1.2rem;
        }

        .nav-label {
            font-size: 0.9rem;
        }

        /* Teacher Sections */
        .teacher-section {
            display: none;
        }

        .teacher-section:first-child {
            display: block;
        }

        /* Management Content Styles */
        .management-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .form-card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .form-card h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(240, 147, 251, 0.3);
        }
    </style>
</head>
<body>
    <!-- Floating Blobs -->
    <div class="blob blob1"></div>
    <div class="blob blob2"></div>
    <div class="blob blob3"></div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">üéì</div>
                <h1>Smart Learning Platform</h1>
            </div>
            <div class="header-actions">
                <button class="nav-btn logout" onclick="logout()">
                    <span>üö™</span> Logout
                </button>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Tab Navigation -->
        <div class="tab-navigation" id="tabNavigation">
            <!-- Tabs will be dynamically loaded based on user role -->
        </div>

        <!-- Student Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="content-section">
                <div class="section-header">
                    <h2>üìä My Learning Dashboard</h2>
                    <p>Track your progress and view your learning journey</p>
                </div>

                <!-- Student Welcome Card -->
                <div class="welcome-card">
                    <div class="welcome-content">
                        <div class="welcome-avatar">üéì</div>
                        <div class="welcome-info">
                            <h3 id="studentWelcomeName">Welcome back!</h3>
                            <p id="studentRole">Student</p>
                        </div>
                    </div>
                </div>

                <!-- Progress Overview -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üìà</div>
                        <div class="stat-content">
                            <div class="stat-value" id="progressPercentage">0%</div>
                            <div class="stat-label">Overall Progress</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üß†</div>
                        <div class="stat-content">
                            <div class="stat-value" id="cognitiveLevel">0%</div>
                            <div class="stat-label">Cognitive Load</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üëÅÔ∏è</div>
                        <div class="stat-content">
                            <div class="stat-value" id="engagementRate">0%</div>
                            <div class="stat-label">Engagement</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚è±Ô∏è</div>
                        <div class="stat-content">
                            <div class="stat-value" id="totalTimeSpent">0h</div>
                            <div class="stat-label">Time Spent</div>
                        </div>
                    </div>
                </div>

                <!-- Current Courses -->
                <div class="courses-section">
                    <h3>üìö My Courses</h3>
                    <div class="courses-grid" id="studentCoursesGrid">
                        <!-- Courses will be loaded here -->
                    </div>
                </div>

                <div class="loading" id="dashboard-loading">
                    <div class="spinner"></div>
                    <p>Loading your dashboard...</p>
                </div>
            </div>
        </div>

        <!-- Courses Tab -->
        <div id="courses" class="tab-content">
            <div class="content-section">
                <div class="section-header">
                    <h2>üìö Course Management</h2>
                    <p>Browse courses and manage student enrollment</p>
                </div>

                <div class="form-grid">
                    <div class="form-card">
                        <h3><span>üìñ</span> Browse All Courses</h3>
                        <button class="btn btn-primary" onclick="loadCourses()">Load All Courses</button>
                    </div>

                    <div class="form-card">
                        <h3><span>‚úèÔ∏è</span> Create New Course</h3>
                        <div class="form-group">
                            <label for="course-title">Course Title:</label>
                            <input type="text" id="course-title" placeholder="Enter course title">
                        </div>
                        <div class="form-group">
                            <label for="course-description">Description:</label>
                            <textarea id="course-description" placeholder="Enter course description"></textarea>
                        </div>
                        
                        <!-- Video Options -->
                        <div class="form-group">
                            <label><strong>üé• Video Content</strong></label>
                            <div class="radio-group">
                                <label>
                                    <input type="radio" name="video-source" value="url" checked onchange="toggleVideoInput('url')">
                                    Use Video URL
                                </label>
                                <label>
                                    <input type="radio" name="video-source" value="file" onchange="toggleVideoInput('file')">
                                    Upload Video File
                                </label>
                            </div>
                        </div>
                        <div class="form-group" id="video-url-group">
                            <label for="course-video">Video URL:</label>
                            <input type="url" id="course-video" placeholder="https://youtube.com/watch?v=... or https://example.com/video.mp4">
                        </div>
                        <div class="form-group" id="video-file-group" style="display:none;">
                            <label for="course-video-file">Upload Video File:</label>
                            <input type="file" id="course-video-file" accept="video/*">
                            <small>Supported formats: MP4, WebM, OGG (max 100MB)</small>
                        </div>
                        
                        <!-- PDF Options -->
                        <div class="form-group">
                            <label><strong>üìÑ PDF Content</strong></label>
                            <div class="radio-group">
                                <label>
                                    <input type="radio" name="pdf-source" value="url" checked onchange="togglePdfInput('url')">
                                    Use PDF URL
                                </label>
                                <label>
                                    <input type="radio" name="pdf-source" value="file" onchange="togglePdfInput('file')">
                                    Upload PDF File
                                </label>
                                <label>
                                    <input type="radio" name="pdf-source" value="none" onchange="togglePdfInput('none')">
                                    No PDF
                                </label>
                            </div>
                        </div>
                        <div class="form-group" id="pdf-url-group">
                            <label for="course-pdf">PDF URL:</label>
                            <input type="url" id="course-pdf" placeholder="https://example.com/document.pdf">
                        </div>
                        <div class="form-group" id="pdf-file-group" style="display:none;">
                            <label for="course-pdf-file">Upload PDF File:</label>
                            <input type="file" id="course-pdf-file" accept=".pdf">
                            <small>Max file size: 50MB</small>
                        </div>
                        
                        <button class="btn btn-success" onclick="createCourse()">Create Course</button>
                    </div>

                    <div class="form-card">
                        <h3><span>üéØ</span> Enroll Student</h3>
                        <div class="form-group">
                            <label for="enroll-student-id">Student ID:</label>
                            <input type="number" id="enroll-student-id" value="1" min="1">
                        </div>
                        <div class="form-group">
                            <label for="enroll-course-id">Course ID:</label>
                            <input type="number" id="enroll-course-id" value="1" min="1">
                        </div>
                        <button class="btn btn-primary" onclick="enrollStudent()">Enroll Student</button>
                    </div>
                </div>

                <div class="data-grid" id="courses-results">
                    <!-- Courses will be loaded here -->
                </div>

                <div class="loading" id="courses-loading">
                    <div class="spinner"></div>
                    <p>Loading courses...</p>
                </div>
            </div>
        </div>

        <!-- Student Learning Tab -->
        <div id="learning" class="tab-content">
            <div class="content-section">
                <div class="section-header">
                    <h2>üéì My Learning Hub</h2>
                    <p>Attend courses, take notes, and get AI assistance - all in one place</p>
                </div>

                <!-- Course Player Section -->
                <div class="learning-grid">
                    <div class="course-section">
                        <div class="section-card">
                            <h3>üìö Current Course</h3>
                            <div id="currentCourseInfo">
                                <div class="course-placeholder">
                                    <p>Select a course to begin learning</p>
                                </div>
                            </div>
                            <div class="course-controls">
                                <div class="form-group">
                                    <label for="courseSelect">Choose Course:</label>
                                    <select id="courseSelect" onchange="loadSelectedCourse()">
                                        <option value="">Select a course...</option>
                                    </select>
                                </div>
                                <div id="coursePlayer" style="display:none;">
                                    <!-- Video Progress Section -->
                                    <div class="video-progress-section">
                                        <div class="progress-header">
                                            <h4>üìπ Course Video</h4>
                                            <div class="progress-info">
                                                <span id="videoProgress">0%</span> completed
                                                <span id="videoTime">0:00 / 0:00</span>
                                            </div>
                                        </div>
                                        <div class="video-progress-bar">
                                            <div class="video-progress-fill" id="videoProgressFill" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Video Player -->
                                    <div class="video-container">
                                        <video id="courseVideo" controls style="width: 100%; max-height: 400px;" 
                                               ontimeupdate="updateVideoProgress()" 
                                               onloadedmetadata="onVideoLoaded()"
                                               onended="onVideoCompleted()">
                                        </video>
                                    </div>
                                    
                                    <!-- PDF Section -->
                                    <div class="pdf-section">
                                        <div class="pdf-header">
                                            <h4>üìÑ Course Materials</h4>
                                            <div class="pdf-actions">
                                                <button class="btn btn-sm btn-primary" onclick="viewPDF()" id="viewPDFBtn">
                                                    üëÅÔ∏è View PDF
                                                </button>
                                                <button class="btn btn-sm btn-success" onclick="downloadPDF()" id="downloadPDFBtn">
                                                    üì• Download PDF
                                                </button>
                                            </div>
                                        </div>
                                        <div class="pdf-container" id="pdfContainer" style="display:none;">
                                            <iframe id="pdfViewer" style="width: 100%; height: 500px;" frameborder="0"></iframe>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Learning Camera Section -->
                    <div class="camera-section">
                        <div class="section-card">
                            <h3>üëÅÔ∏è Learning Analytics</h3>
                            <div class="camera-container">
                                <video id="video-feed" autoplay playsinline style="width: 100%; max-height: 200px; border-radius: 10px;"></video>
                                <div class="camera-controls">
                                    <button class="btn btn-success" onclick="startCamera()" id="startCamBtn">üé• Start Camera</button>
                                    <button class="btn btn-danger" onclick="stopCamera()" id="stopCamBtn" disabled>‚èπÔ∏è Stop Camera</button>
                                    <button class="btn btn-primary" onclick="toggleAutoTracking()" id="autoTrackBtn">ÔøΩ Auto Track</button>
                                </div>
                                <div class="metrics-display">
                                    <div class="metric-item">
                                        <span class="metric-label">üëÅÔ∏è Gaze:</span>
                                        <span class="metric-value" id="gazeScore">--%</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-label">üéØ Attention:</span>
                                        <span class="metric-value" id="attentionScore">--%</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-label">üß† Cognitive Load:</span>
                                        <span class="metric-value" id="cognitiveLoad">--%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notes & Chatbot Section -->
                <div class="notes-chat-grid">
                    <!-- Notes Section -->
                    <div class="notes-section">
                        <div class="section-card">
                            <h3>üìù My Notes</h3>
                            <div class="notes-controls">
                                <div class="form-group">
                                    <label for="noteFile">Upload Notes:</label>
                                    <input type="file" id="noteFile" accept=".txt,.pdf" onchange="uploadNotes()">
                                </div>
                                <div class="notes-list" id="notesList">
                                    <div class="notes-placeholder">
                                        <p>Upload notes to get started</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Chatbot Section -->
                    <div class="chatbot-section">
                        <div class="section-card">
                            <h3>ü§ñ AI Learning Assistant</h3>
                            <div class="chatbot-controls">
                                <div class="form-group">
                                    <label for="chatMessage">Ask about your course:</label>
                                    <textarea id="chatMessage" placeholder="Type your question here..." rows="3"></textarea>
                                </div>
                                <div class="chat-context" id="chatContext">
                                    <small>üí° You can ask questions about your current course or uploaded notes</small>
                                </div>
                                <button class="btn btn-primary" onclick="sendChatMessage()">üí¨ Send Message</button>
                                <div class="chat-history" id="chatHistory">
                                    <div class="chat-placeholder">
                                        <p>Start a conversation with your AI assistant</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Progress Update -->
                <div class="progress-section">
                    <div class="section-card">
                        <h3>üìà Learning Progress</h3>
                        <div class="progress-controls">
                            <div class="form-group">
                                <label for="timeSpent">Time Spent (minutes):</label>
                                <input type="number" id="timeSpent" value="30" min="1">
                                <button class="btn btn-success" onclick="updateLearningProgress()">‚úÖ Update Progress</button>
                            </div>
                            <div class="progress-display">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                                </div>
                                <span class="progress-text" id="progressText">0% Complete</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="loading" id="learning-loading">
                    <div class="spinner"></div>
                    <p>Processing...</p>
                </div>
            </div>
        </div>

        <!-- Notes Tab -->
        <div id="notes" class="tab-content">
            <div class="content-section">
                <div class="section-header">
                    <h2>üìù Notes Management</h2>
                    <p>Upload, organize, and test AI-powered note summarization</p>
                </div>

                <div class="form-grid">
                    <div class="form-card">
                        <h3><span>üì§</span> Upload Note</h3>
                        <div class="form-group">
                            <label for="notes-student-id">Student ID:</label>
                            <input type="number" id="notes-student-id" value="1" min="1">
                        </div>
                        <div class="form-group">
                            <label for="note-file">Select File (TXT/PDF):</label>
                            <input type="file" id="note-file" accept=".txt,.pdf">
                        </div>
                        <button class="btn btn-success" onclick="uploadNote()">Upload & Summarize</button>
                    </div>

                    <div class="form-card">
                        <h3><span>üìã</span> View Notes</h3>
                        <div class="form-group">
                            <label for="view-notes-student-id">Student ID:</label>
                            <input type="number" id="view-notes-student-id" value="1" min="1">
                        </div>
                        <button class="btn btn-primary" onclick="loadNotes()">Load Student Notes</button>
                    </div>
                </div>

                <div class="data-grid" id="notes-results">
                    <!-- Notes will be loaded here -->
                </div>

                <div class="loading" id="notes-loading">
                    <div class="spinner"></div>
                    <p>Processing notes...</p>
                </div>
            </div>
        </div>

        <!-- Chatbot Tab -->
        <div id="chatbot" class="tab-content">
            <div class="content-section">
                <div class="section-header">
                    <h2>ü§ñ AI Learning Assistant</h2>
                    <p>Test the rule-based chatbot for learning support</p>
                </div>

                <div class="form-grid">
                    <div class="form-card">
                        <h3><span>üí¨</span> Chat Interface</h3>
                        <div class="form-group">
                            <label for="chat-message">Your Message:</label>
                            <textarea id="chat-message" placeholder="Ask me anything about your studies..." rows="4"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="chat-context">Context (optional):</label>
                            <input type="text" id="chat-context" placeholder="Additional context...">
                        </div>
                        <button class="btn btn-primary" onclick="sendChatMessage()">Send Message</button>
                    </div>

                    <div class="form-card">
                        <h3><span>‚ö°</span> Quick Questions</h3>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <button class="btn btn-secondary" onclick="sendQuickQuestion('Explain photosynthesis')">üå± Explain photosynthesis</button>
                            <button class="btn btn-secondary" onclick="sendQuickQuestion('Help with math homework')">üìê Help with math</button>
                            <button class="btn btn-secondary" onclick="sendQuickQuestion('Study tips for exams')">üìù Study tips</button>
                            <button class="btn btn-secondary" onclick="sendQuickQuestion('How to write an essay')">‚úçÔ∏è Essay writing</button>
                        </div>
                    </div>
                </div>

                <div class="response-area" id="chat-response">
                    Chat responses will appear here...
                </div>

                <div class="loading" id="chat-loading">
                    <div class="spinner"></div>
                    <p>AI is thinking...</p>
                </div>
            </div>
        </div>

        <!-- Teacher Panel Tab -->
        <div id="teacher" class="tab-content">
            <!-- Teacher Navigation Bar -->
            <div class="teacher-navbar">
                <div class="nav-item active" onclick="showTeacherSection('overview')">
                    <span class="nav-icon">üìä</span>
                    <span class="nav-label">Overview</span>
                </div>
                <div class="nav-item" onclick="showTeacherSection('courses')">
                    <span class="nav-icon">üìö</span>
                    <span class="nav-label">Course Management</span>
                </div>
                <div class="nav-item" onclick="showTeacherSection('students')">
                    <span class="nav-icon">üë•</span>
                    <span class="nav-label">Student Management</span>
                </div>
                <div class="nav-item" onclick="showTeacherSection('analytics')">
                    <span class="nav-icon">üìà</span>
                    <span class="nav-label">Analytics</span>
                </div>
                <div class="nav-item" onclick="showTeacherSection('settings')">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span class="nav-label">Settings</span>
                </div>
            </div>

            <!-- Teacher Overview Section -->
            <div class="teacher-section" id="teacher-overview">
                <div class="content-section">
                    <div class="section-header">
                        <h2>üë®‚Äçüè´ Teacher Control Panel</h2>
                        <p>Manage courses, students, and view analytics</p>
                    </div>

                    <div class="form-grid">
                        <div class="form-card">
                            <h3><span>üë•</span> Student Management</h3>
                            <button class="btn btn-primary" onclick="loadAllStudents()">Load All Students</button>
                        </div>

                        <div class="form-card">
                            <h3><span>üìä</span> Student Analytics</h3>
                            <div class="form-group">
                                <label for="analytics-student-id">Student ID:</label>
                                <input type="number" id="analytics-student-id" value="1" min="1">
                            </div>
                            <button class="btn btn-primary" onclick="loadStudentAnalytics()">Load Analytics</button>
                        </div>

                        <div class="form-card">
                            <h3><span>‚öôÔ∏è</span> Update Student Settings</h3>
                            <div class="form-group">
                                <label for="update-student-id">Student ID:</label>
                                <input type="number" id="update-student-id" value="1" min="1">
                            </div>
                            <div class="form-group">
                                <label for="cognitive-limit">Cognitive Limit:</label>
                                <input type="number" id="cognitive-limit" value="50" min="1" max="100">
                            </div>
                            <div class="form-group">
                                <label for="assigned-course-id">Assigned Course ID:</label>
                                <input type="number" id="assigned-course-id" value="1" min="1">
                            </div>
                            <button class="btn btn-success" onclick="updateStudentSettings()">Update Settings</button>
                        </div>
                    </div>

                    <div class="data-grid" id="teacher-results">
                        <!-- Teacher data will be loaded here -->
                    </div>

                    <div class="charts-grid">
                        <div class="chart-card">
                            <h4>üìà Student Progress</h4>
                            <canvas id="progress-chart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h4>üß† Cognitive Load Trends</h4>
                        <canvas id="teacher-cognitive-chart"></canvas>
                    </div>
                </div>

                <div class="loading" id="teacher-loading">
                    <div class="spinner"></div>
                    <p>Loading teacher data...</p>
                </div>
            </div>
        </div>

        <!-- Teacher Course Management Section -->
        <div class="teacher-section" id="teacher-courses" style="display: none;">
            <div class="content-section">
                <div class="section-header">
                    <h2>üìö Course Management</h2>
                    <p>Create, edit, and organize courses</p>
                </div>
                <div class="management-content">
                    <div class="form-card">
                        <h3>Create New Course</h3>
                        <div class="form-group">
                            <label>Course Title:</label>
                            <input type="text" id="courseTitle" placeholder="Enter course title">
                        </div>
                        <div class="form-group">
                            <label>Description:</label>
                            <textarea id="courseDescription" placeholder="Enter course description"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Video URL:</label>
                            <input type="text" id="courseVideoUrl" placeholder="Enter video URL">
                        </div>
                        <div class="form-group">
                            <label>PDF URL:</label>
                            <input type="text" id="coursePdfUrl" placeholder="Enter PDF URL">
                        </div>
                        <button class="btn btn-primary" onclick="createCourse()">Create Course</button>
                    </div>
                    <div class="form-card">
                        <h3>Existing Courses</h3>
                        <button class="btn btn-secondary" onclick="loadCourses()">Load All Courses</button>
                        <div id="coursesList"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Teacher Student Management Section -->
        <div class="teacher-section" id="teacher-students" style="display: none;">
            <div class="content-section">
                <div class="section-header">
                    <h2>üë• Student Management</h2>
                    <p>View and manage all students</p>
                </div>
                <div class="management-content">
                    <div class="form-card">
                        <h3>All Students</h3>
                        <button class="btn btn-primary" onclick="loadAllStudents()">Load Students</button>
                        <div id="studentsList"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Teacher Analytics Section -->
        <div class="teacher-section" id="teacher-analytics" style="display: none;">
            <div class="content-section">
                <div class="section-header">
                    <h2>üìà Analytics & Insights</h2>
                    <p>View learning analytics and patterns</p>
                </div>
                <div class="management-content">
                    <div class="form-card">
                        <h3>Student Progress Analytics</h3>
                        <button class="btn btn-primary" onclick="loadAnalytics()">Load Analytics</button>
                        <div id="analyticsData"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Teacher Settings Section -->
        <div class="teacher-section" id="teacher-settings" style="display: none;">
            <div class="content-section">
                <div class="section-header">
                    <h2>‚öôÔ∏è Settings</h2>
                    <p>Configure system settings</p>
                </div>
                <div class="management-content">
                    <div class="form-card">
                        <h3>System Configuration</h3>
                        <div class="form-group">
                            <label>Max Students per Course:</label>
                            <input type="number" id="maxStudents" value="50">
                        </div>
                        <div class="form-group">
                            <label>Default Course Duration (hours):</label>
                            <input type="number" id="courseDuration" value="40">
                        </div>
                        <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        let currentStream = null;
        let autoTrackingInterval = null;
        let metricsData = [];
        let currentUser = null;
        let currentCourse = null;
        let uploadedNotes = [];

        // Initialize page with student-focused content
        window.onload = function() {
            // Check for stored user session
            const storedUser = localStorage.getItem('currentUser');
            if (storedUser) {
                currentUser = JSON.parse(storedUser);
            }
            
            // Always initialize as student interface
            initializeStudentInterface();
        };

        // Initialize student interface
        function initializeStudentInterface() {
            loadRoleBasedTabs();
        }

        // Load current student dashboard data
        async function loadStudentDashboard() {
            showLoading('dashboard-loading');
            
            try {
                // Get current user from localStorage
                const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                
                // Update welcome message
                const welcomeName = document.getElementById('studentWelcomeName');
                const studentRole = document.getElementById('studentRole');
                if (welcomeName) {
                    welcomeName.textContent = `Welcome back, ${currentUser.user_name || 'Student'}!`;
                }
                if (studentRole) {
                    studentRole.textContent = 'Student';
                }

                // Load dashboard data if student_id exists
                if (currentUser.student_id) {
                    const response = await fetch(`${API_BASE}/students/${currentUser.student_id}/dashboard`);
                    const data = await response.json();
                    
                    if (response.ok) {
                        updateDashboardStats(data);
                    }
                } else {
                    // Show default values if no student_id
                    updateDashboardStats({
                        progress_percentage: 0,
                        cognitive_load_level: 0,
                        engagement: 0,
                        total_time_spent: 0
                    });
                }

                // Load available courses
                await loadAvailableCourses();
                
            } catch (error) {
                console.error('Error loading dashboard:', error);
                // Show default values on error
                updateDashboardStats({
                    progress_percentage: 0,
                    cognitive_load_level: 0,
                    engagement: 0,
                    total_time_spent: 0
                });
            } finally {
                hideLoading('dashboard-loading');
            }
        }

        // Load all available courses for the student
        async function loadAvailableCourses() {
            try {
                const response = await fetch(`${API_BASE}/courses`);
                const courses = await response.json();
                
                if (response.ok) {
                    displayAvailableCourses(courses);
                } else {
                    console.error('Failed to load courses');
                }
            } catch (error) {
                console.error('Error loading courses:', error);
            }
        }

        // Display available courses with progress
        function displayAvailableCourses(courses) {
            const coursesGrid = document.getElementById('studentCoursesGrid');
            if (!coursesGrid) return;

            if (courses.length === 0) {
                coursesGrid.innerHTML = '<p>No courses available. Contact your teacher to get assigned courses.</p>';
                return;
            }

            coursesGrid.innerHTML = courses.map(course => {
                // Generate random progress for demo (in real app, this would come from backend)
                const progress = Math.random() * 100;
                const progressPercentage = progress.toFixed(1);
                
                return `
                    <div class="course-item" onclick="startCourseFromDashboard(${course.id})">
                        <div class="course-header">
                            <h4>${course.title}</h4>
                            <span class="course-status">${progress > 50 ? 'In Progress' : 'Not Started'}</span>
                        </div>
                        <p>${course.description || 'No description available'}</p>
                        <div class="course-progress">
                            <div class="course-progress-fill" style="width: ${progressPercentage}%"></div>
                        </div>
                        <div class="course-progress-text">${progressPercentage}% Complete</div>
                        <div class="course-materials">
                            ${course.video_url ? '<span class="material-tag">üé• Video</span>' : ''}
                            ${course.pdf_url ? '<span class="material-tag">üìÑ PDF</span>' : ''}
                        </div>
                        <div class="course-actions">
                            <button class="course-action-btn ${progress > 0 ? 'continue' : 'start'}">
                                ${progress > 0 ? 'üîÑ Continue Studying' : 'üöÄ Start Course'}
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Start or continue a course from dashboard
        async function startCourseFromDashboard(courseId) {
            try {
                const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                
                if (currentUser.student_id) {
                    // Enroll in the course
                    const response = await fetch(`${API_BASE}/students/${currentUser.student_id}/start_course/${courseId}`, {
                        method: 'POST'
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok) {
                        // Switch to learning hub and load the course
                        showTab('learning');
                        setTimeout(() => {
                            const courseSelect = document.getElementById('courseSelect');
                            if (courseSelect) {
                                courseSelect.value = courseId;
                                loadSelectedCourse();
                            }
                        }, 100);
                    } else {
                        console.error('Failed to enroll in course:', data.detail);
                        // Still try to switch to learning hub
                        showTab('learning');
                        setTimeout(() => {
                            const courseSelect = document.getElementById('courseSelect');
                            if (courseSelect) {
                                courseSelect.value = courseId;
                                loadSelectedCourse();
                            }
                        }, 100);
                    }
                } else {
                    // If no student_id, just switch to learning hub
                    showTab('learning');
                    setTimeout(() => {
                        const courseSelect = document.getElementById('courseSelect');
                        if (courseSelect) {
                            courseSelect.value = courseId;
                            loadSelectedCourse();
                        }
                    }, 100);
                }
            } catch (error) {
                console.error('Error starting course:', error);
                // Fallback: just switch to learning hub
                showTab('learning');
                setTimeout(() => {
                    const courseSelect = document.getElementById('courseSelect');
                    if (courseSelect) {
                        courseSelect.value = courseId;
                        loadSelectedCourse();
                    }
                }, 100);
            }
        }

        // Update dashboard statistics
        function updateDashboardStats(data) {
            const progressPercentage = document.getElementById('progressPercentage');
            const cognitiveLevel = document.getElementById('cognitiveLevel');
            const engagementRate = document.getElementById('engagementRate');
            const totalTimeSpent = document.getElementById('totalTimeSpent');
            
            if (progressPercentage) {
                progressPercentage.textContent = `${(data.progress_percentage * 100).toFixed(1)}%`;
            }
            if (cognitiveLevel) {
                cognitiveLevel.textContent = `${data.cognitive_load_level || 0}%`;
            }
            if (engagementRate) {
                engagementRate.textContent = `${(data.engagement || 0.85 * 100).toFixed(1)}%`;
            }
            if (totalTimeSpent) {
                const hours = Math.floor((data.total_time_spent || 0) / 60);
                const minutes = (data.total_time_spent || 0) % 60;
                totalTimeSpent.textContent = hours > 0 ? `${hours}h ${minutes}m` : `${minutes}m`;
            }
        }

        // Load tabs based on user role and URL hash
        function loadRoleBasedTabs() {
            const tabNavigation = document.getElementById('tabNavigation');
            tabNavigation.innerHTML = '';

            // Check if accessing teacher panel
            if (window.location.hash === '#teacher') {
                // Show teacher tabs
                const teacherTabs = [
                    { id: 'teacher', icon: 'üë®‚Äçüè´', label: 'Teacher Panel' }
                ];

                teacherTabs.forEach((tab, index) => {
                    const button = document.createElement('button');
                    button.className = `tab-btn ${index === 0 ? 'active' : ''}`;
                    button.onclick = () => showTab(tab.id);
                    button.innerHTML = `<span class="tab-icon">${tab.icon}</span> ${tab.label}`;
                    tabNavigation.appendChild(button);
                });

                // Show teacher tab
                document.getElementById('teacher').classList.add('active');
            } else {
                // Show student tabs (default behavior)
                const studentTabs = [
                    { id: 'dashboard', icon: 'üìä', label: 'My Dashboard' },
                    { id: 'learning', icon: 'üéì', label: 'Learning Hub' },
                    { id: 'courses', icon: 'üìö', label: 'My Courses' },
                    { id: 'notes', icon: 'üìù', label: 'Notes' },
                    { id: 'chatbot', icon: 'ü§ñ', label: 'AI Assistant' }
                ];

                studentTabs.forEach((tab, index) => {
                    const button = document.createElement('button');
                    button.className = `tab-btn ${index === 0 ? 'active' : ''}`;
                    button.onclick = () => showTab(tab.id);
                    button.innerHTML = `<span class="tab-icon">${tab.icon}</span> ${tab.label}`;
                    tabNavigation.appendChild(button);
                });

                // Show first student tab
                document.getElementById('dashboard').classList.add('active');
                
                // Load current student data automatically for student interface
                loadStudentDashboard();
                loadStudentCourses();
                loadStudentNotes();
                
                // Auto-start camera when learning tab is opened
                if (window.location.hash === '#learning') {
                    setTimeout(() => startCamera(), 1000);
                }
            }
        }

        // Tab Management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            const selectedTab = document.getElementById(tabName);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
            
            // Add active class to clicked button
            event.target.classList.add('active');

            // Auto-start camera when learning tab is opened
            if (tabName === 'learning') {
                setTimeout(() => {
                    if (!currentStream) {
                        startCamera();
                    }
                }, 500);
            }
        }

        // Student Learning Hub Functions
        async function loadStudentCourses() {
            if (!currentUser || currentUser.role !== 'student') return;
            
            try {
                const response = await fetch(`${API_BASE}/courses`);
                const courses = await response.json();
                
                if (response.ok) {
                    const courseSelect = document.getElementById('courseSelect');
                    if (courseSelect) {
                        courseSelect.innerHTML = '<option value="">Select a course...</option>';
                        courses.forEach(course => {
                            const option = document.createElement('option');
                            option.value = course.id;
                            option.textContent = course.title;
                            courseSelect.appendChild(option);
                        });
                    }
                }
            } catch (error) {
                console.error('Error loading courses:', error);
            }
        }

        async function loadSelectedCourse() {
            const courseId = document.getElementById('courseSelect').value;
            if (!courseId) {
                currentCourse = null;
                document.getElementById('coursePlayer').style.display = 'none';
                document.getElementById('currentCourseInfo').innerHTML = `
                    <div class="course-placeholder">
                        <p>Select a course to begin learning</p>
                    </div>
                `;
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/courses`);
                const courses = await response.json();
                
                if (response.ok) {
                    currentCourse = courses.find(c => c.id == courseId);
                    if (currentCourse) {
                        displayCurrentCourse();
                    }
                }
            } catch (error) {
                console.error('Error loading course:', error);
            }
        }

        function displayCurrentCourse() {
            const courseInfo = document.getElementById('currentCourseInfo');
            const coursePlayer = document.getElementById('coursePlayer');
            
            courseInfo.innerHTML = `
                <div class="course-info">
                    <h4>${currentCourse.title}</h4>
                    <p>${currentCourse.description || 'No description available'}</p>
                    <div class="course-materials">
                        ${currentCourse.video_url ? `<span class="material-tag">üé• Video Available</span>` : ''}
                        ${currentCourse.pdf_url ? `<span class="material-tag">üìÑ PDF Available</span>` : ''}
                    </div>
                </div>
            `;

            coursePlayer.style.display = 'block';
            
            // Reset progress tracking
            currentVideoProgress = 0;
            lastProgressUpdate = 0;
            
            // Load video if available
            if (currentCourse.video_url) {
                const video = document.getElementById('courseVideo');
                video.src = currentCourse.video_url;
                video.style.display = 'block';
                document.getElementById('pdfContainer').style.display = 'none';
                
                // Show PDF button if PDF is available
                if (currentCourse.pdf_url) {
                    document.getElementById('viewPDFBtn').style.display = 'inline-block';
                    document.getElementById('downloadPDFBtn').style.display = 'inline-block';
                } else {
                    document.getElementById('viewPDFBtn').style.display = 'none';
                    document.getElementById('downloadPDFBtn').style.display = 'none';
                }
            } else {
                // No video, show PDF by default if available
                document.getElementById('courseVideo').style.display = 'none';
                if (currentCourse.pdf_url) {
                    viewPDF();
                }
            }
            
            // Load course progress from database
            loadCourseProgress();
        }

        // Video Progress Tracking Variables
        let currentVideoProgress = 0;
        let lastProgressUpdate = 0;
        let progressUpdateInterval = null;

        // Load saved course progress
        async function loadCourseProgress() {
            if (!currentUser || !currentCourse) return;
            
            try {
                const response = await fetch(`${API_BASE}/students/${currentUser.student_id}/course_progress/${currentCourse.id}`);
                const data = await response.json();
                
                if (response.ok && data.progress) {
                    currentVideoProgress = data.progress;
                    updateVideoProgressDisplay();
                    
                    // Set video current time if video is loaded
                    const video = document.getElementById('courseVideo');
                    if (video && video.duration) {
                        video.currentTime = (currentVideoProgress / 100) * video.duration;
                    }
                }
            } catch (error) {
                console.error('Error loading course progress:', error);
            }
        }

        // Update video progress display
        function updateVideoProgressDisplay() {
            const progressFill = document.getElementById('videoProgressFill');
            const progressText = document.getElementById('videoProgress');
            const timeText = document.getElementById('videoTime');
            const video = document.getElementById('courseVideo');
            
            if (progressFill) progressFill.style.width = `${currentVideoProgress}%`;
            if (progressText) progressText.textContent = `${currentVideoProgress.toFixed(1)}%`;
            
            if (video && !isNaN(video.duration)) {
                const currentTime = formatTime(video.currentTime);
                const duration = formatTime(video.duration);
                if (timeText) timeText.textContent = `${currentTime} / ${duration}`;
            }
        }

        // Format time helper
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs.toString().padStart(2, '0')}`;
        }

        // Video event handlers
        function onVideoLoaded() {
            const video = document.getElementById('courseVideo');
            console.log('Video loaded, duration:', video.duration);
            
            // Set current time based on saved progress
            if (currentVideoProgress > 0 && video.duration) {
                video.currentTime = (currentVideoProgress / 100) * video.duration;
            }
            
            updateVideoProgressDisplay();
        }

        function updateVideoProgress() {
            const video = document.getElementById('courseVideo');
            if (!video || !video.duration) return;
            
            // Calculate progress percentage
            const progress = (video.currentTime / video.duration) * 100;
            currentVideoProgress = progress;
            
            updateVideoProgressDisplay();
            
            // Save progress to database every 5% or every 10 seconds
            const now = Date.now();
            const shouldUpdate = Math.abs(progress - lastProgressUpdate) >= 5 || 
                                (now - lastProgressUpdate > 10000 && progress > 0);
            
            if (shouldUpdate) {
                saveVideoProgress();
                lastProgressUpdate = progress;
            }
        }

        async function saveVideoProgress() {
            if (!currentUser || !currentCourse) return;
            
            try {
                const response = await fetch(`${API_BASE}/students/${currentUser.student_id}/update_progress`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        course_id: currentCourse.id,
                        progress_percentage: currentVideoProgress / 100,
                        time_spent: Math.floor(document.getElementById('courseVideo').currentTime / 60),
                        cognitive_load_level: 50, // Default value
                        engagement_level: 85 // Default value
                    })
                });
                
                if (response.ok) {
                    console.log('Progress saved:', currentVideoProgress.toFixed(1) + '%');
                }
            } catch (error) {
                console.error('Error saving progress:', error);
            }
        }

        function onVideoCompleted() {
            // Mark course as 100% complete
            currentVideoProgress = 100;
            updateVideoProgressDisplay();
            saveVideoProgress();
            
            // Show completion message
            alert('üéâ Congratulations! You have completed this course.');
        }

        // PDF Functions
        function viewPDF() {
            if (!currentCourse || !currentCourse.pdf_url) return;
            
            const pdfContainer = document.getElementById('pdfContainer');
            const pdfViewer = document.getElementById('pdfViewer');
            
            pdfViewer.src = currentCourse.pdf_url;
            pdfContainer.style.display = 'block';
            
            // Hide video if showing
            const video = document.getElementById('courseVideo');
            if (video) video.style.display = 'none';
        }

        function downloadPDF() {
            if (!currentCourse || !currentCourse.pdf_url) return;
            
            // Create a temporary link element
            const link = document.createElement('a');
            link.href = currentCourse.pdf_url;
            link.download = `${currentCourse.title.replace(/[^a-z0-9]/gi, '_')}.pdf`;
            link.target = '_blank';
            
            // Trigger download
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        async function loadStudentNotes() {
            if (!currentUser || currentUser.role !== 'student') return;
            
            try {
                const response = await fetch(`${API_BASE}/students/${currentUser.student_id}/notes`);
                const notes = await response.json();
                
                if (response.ok) {
                    uploadedNotes = notes;
                    displayStudentNotes();
                }
            } catch (error) {
                console.error('Error loading notes:', error);
            }
        }

        function displayStudentNotes() {
            const notesList = document.getElementById('notesList');
            if (!notesList) return;

            if (uploadedNotes.length === 0) {
                notesList.innerHTML = `
                    <div class="notes-placeholder">
                        <p>Upload notes to get started</p>
                    </div>
                `;
                return;
            }

            notesList.innerHTML = uploadedNotes.map(note => `
                <div class="note-item" onclick="selectNoteForChat(${note.id})">
                    <div class="note-title">üìÑ Note ${note.id}</div>
                    <div class="note-summary">${note.summary ? note.summary.substring(0, 100) + '...' : 'No summary available'}</div>
                </div>
            `).join('');
        }

        async function uploadNotes() {
            const fileInput = document.getElementById('noteFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a file to upload');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch(`${API_BASE}/students/${currentUser.student_id}/upload_notes`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (response.ok) {
                    uploadedNotes.push({
                        id: data.id || uploadedNotes.length + 1,
                        file_path: data.filename,
                        summary: data.summary
                    });
                    displayStudentNotes();
                    fileInput.value = '';
                    alert('Note uploaded successfully!');
                } else {
                    alert('Failed to upload note: ' + (data.detail || 'Unknown error'));
                }
            } catch (error) {
                alert('Error uploading note: ' + error.message);
            }
        }

        function selectNoteForChat(noteId) {
            const note = uploadedNotes.find(n => n.id === noteId);
            if (note) {
                const chatContext = document.getElementById('chatContext');
                chatContext.innerHTML = `
                    <small>üí° Currently discussing: üìÑ Note ${note.id}</small>
                    <small>${note.summary ? note.summary.substring(0, 100) + '...' : 'No summary available'}</small>
                `;
                chatContext.dataset.noteId = noteId;
            }
        }

        async function sendChatMessage() {
            const messageInput = document.getElementById('chatMessage');
            const message = messageInput.value.trim();
            
            if (!message) {
                alert('Please enter a message');
                return;
            }

            const chatHistory = document.getElementById('chatHistory');
            const chatContext = document.getElementById('chatContext');
            const noteId = chatContext.dataset.noteId;

            // Add user message to chat
            const userMessage = document.createElement('div');
            userMessage.className = 'chat-message user';
            userMessage.innerHTML = `<strong>You:</strong> ${message}`;
            chatHistory.appendChild(userMessage);

            // Prepare context
            let context = '';
            if (noteId) {
                const note = uploadedNotes.find(n => n.id == noteId);
                if (note) {
                    context = `Regarding note ${noteId}: ${note.summary || 'No summary available'}`;
                }
            }

            if (currentCourse) {
                context += (context ? ' ' : '') + `Currently studying: ${currentCourse.title}`;
            }

            try {
                const response = await fetch(`${API_BASE}/chatbot`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: message,
                        context: context
                    })
                });

                const data = await response.json();

                // Add bot response to chat
                const botMessage = document.createElement('div');
                botMessage.className = 'chat-message bot';
                botMessage.innerHTML = `<strong>ü§ñ Assistant:</strong> ${data.response}`;
                chatHistory.appendChild(botMessage);

                // Scroll to bottom
                chatHistory.scrollTop = chatHistory.scrollHeight;

                // Clear input
                messageInput.value = '';

            } catch (error) {
                const errorMessage = document.createElement('div');
                errorMessage.className = 'chat-message error';
                errorMessage.innerHTML = `<strong>Error:</strong> Failed to get response from assistant`;
                chatHistory.appendChild(errorMessage);
            }
        }

        async function updateLearningProgress() {
            if (!currentUser || currentUser.role !== 'student') return;

            const timeSpent = parseInt(document.getElementById('timeSpent').value);
            const gazeScore = parseFloat(document.getElementById('gazeScore').textContent.replace('%', '')) || 0;
            const attentionScore = parseFloat(document.getElementById('attentionScore').textContent.replace('%', '')) || 0;

            try {
                const response = await fetch(`${API_BASE}/students/${currentUser.student_id}/update_progress`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        time_spent: timeSpent,
                        gaze_score: gazeScore / 100,
                        face_attention_score: attentionScore / 100
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    // Update progress display
                    const progressFill = document.getElementById('progressFill');
                    const progressText = document.getElementById('progressText');
                    const progressPercentage = (data.new_progress * 100).toFixed(1);
                    
                    progressFill.style.width = progressPercentage + '%';
                    progressText.textContent = progressPercentage + '% Complete';
                    
                    alert('Progress updated successfully!');
                } else {
                    alert('Failed to update progress: ' + (data.detail || 'Unknown error'));
                }
            } catch (error) {
                alert('Error updating progress: ' + error.message);
            }
        }

        // Enhanced camera functions for learning hub
        async function startCamera() {
            if (currentStream) return;

            try {
                const video = document.getElementById('video-feed');
                currentStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { width: 640, height: 480, facingMode: 'user' } 
                });
                video.srcObject = currentStream;
                
                // Update button states
                const startBtn = document.getElementById('startCamBtn');
                const stopBtn = document.getElementById('stopCamBtn');
                if (startBtn) startBtn.disabled = true;
                if (stopBtn) stopBtn.disabled = false;
                
                // Start auto tracking
                if (!autoTrackingInterval) {
                    autoTrackingInterval = setInterval(analyzeFrameForLearning, 3000);
                }
                
            } catch (error) {
                console.error('Camera access denied:', error);
            }
        }

        function stopCamera() {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
                currentStream = null;
                
                const video = document.getElementById('video-feed');
                video.srcObject = null;
                
                // Update button states
                const startBtn = document.getElementById('startCamBtn');
                const stopBtn = document.getElementById('stopCamBtn');
                if (startBtn) startBtn.disabled = false;
                if (stopBtn) stopBtn.disabled = true;
                
                // Stop auto tracking
                if (autoTrackingInterval) {
                    clearInterval(autoTrackingInterval);
                    autoTrackingInterval = null;
                }
            }
        }

        function toggleAutoTracking() {
            const autoTrackBtn = document.getElementById('autoTrackBtn');
            
            if (autoTrackingInterval) {
                clearInterval(autoTrackingInterval);
                autoTrackingInterval = null;
                if (autoTrackBtn) autoTrackBtn.textContent = 'üîÑ Auto Track';
            } else {
                if (currentStream) {
                    autoTrackingInterval = setInterval(analyzeFrameForLearning, 3000);
                    if (autoTrackBtn) autoTrackBtn.textContent = '‚è∏Ô∏è Stop Tracking';
                }
            }
        }

        async function analyzeFrameForLearning() {
            if (!currentStream || !currentUser) return;

            try {
                const video = document.getElementById('video-feed');
                const canvas = document.createElement('canvas');
                canvas.width = 640;
                canvas.height = 480;
                const context = canvas.getContext('2d');
                
                context.drawImage(video, 0, 0, canvas.width, canvas.height);
                const imageData = canvas.toDataURL('image/jpeg', 0.8);
                
                const response = await fetch(`${API_BASE}/analyze_image`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        image_data: imageData,
                        student_id: currentUser.student_id
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Update metrics display
                    const gazeScore = document.getElementById('gazeScore');
                    const attentionScore = document.getElementById('attentionScore');
                    const cognitiveLoad = document.getElementById('cognitiveLoad');
                    
                    if (gazeScore) gazeScore.textContent = (data.gaze_score * 100).toFixed(1) + '%';
                    if (attentionScore) attentionScore.textContent = (data.face_attention_score * 100).toFixed(1) + '%';
                    if (cognitiveLoad) cognitiveLoad.textContent = data.cognitive_load.toFixed(1) + '%';
                }
            } catch (error) {
                console.error('Error analyzing frame:', error);
            }
        }

        // Dashboard Functions
        async function loadDashboard() {
            const studentId = document.getElementById('dashboard-student-id').value;
            showLoading('dashboard-loading');
            
            try {
                const response = await fetch(`${API_BASE}/students/${studentId}/dashboard`);
                const data = await response.json();
                
                if (response.ok) {
                    displayDashboardData(data);
                } else {
                    showError('dashboard-results', data.detail || 'Failed to load dashboard');
                }
            } catch (error) {
                showError('dashboard-results', 'Network error: ' + error.message);
            } finally {
                hideLoading('dashboard-loading');
            }
        }

        function displayDashboardData(data) {
            const resultsContainer = document.getElementById('dashboard-results');
            resultsContainer.innerHTML = `
                <div class="data-card">
                    <h4><span>üë§</span> Student Info</h4>
                    <div class="data-item">
                        <span class="data-label">Name:</span>
                        <span class="data-value">${data.student.name}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">ID:</span>
                        <span class="data-value">${data.student.id}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Emotional State:</span>
                        <span class="data-value">${data.emotional_state}</span>
                    </div>
                </div>
                <div class="data-card">
                    <h4><span>üìö</span> Current Course</h4>
                    <div class="data-item">
                        <span class="data-label">Course:</span>
                        <span class="data-value">${data.current_course ? data.current_course.title : 'None'}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Progress:</span>
                        <span class="data-value">${data.progress_percentage.toFixed(1)}%</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Cognitive Load:</span>
                        <span class="data-value">${data.cognitive_load_level}%</span>
                    </div>
                </div>
                <div class="data-card">
                    <h4><span>üéØ</span> Recommendation</h4>
                    <div class="data-item">
                        <span class="data-label">Next Course:</span>
                        <span class="data-value">${data.recommended_next_course ? data.recommended_next_course.title : 'None'}</span>
                    </div>
                </div>
            `;
        }

        async function updateProgress() {
            const studentId = document.getElementById('dashboard-student-id').value;
            const timeSpent = parseFloat(document.getElementById('time-spent').value);
            const gazeScore = parseFloat(document.getElementById('gaze-score').value);
            const attentionScore = parseFloat(document.getElementById('attention-score').value);
            
            showLoading('dashboard-loading');
            
            try {
                const response = await fetch(`${API_BASE}/students/${studentId}/update_progress`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        time_spent: timeSpent,
                        gaze_score: gazeScore,
                        face_attention_score: attentionScore
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showSuccess('dashboard-results', `Progress updated! New progress: ${(data.new_progress * 100).toFixed(1)}%`);
                } else {
                    showError('dashboard-results', data.detail || 'Failed to update progress');
                }
            } catch (error) {
                showError('dashboard-results', 'Network error: ' + error.message);
            } finally {
                hideLoading('dashboard-loading');
            }
        }

        // Courses Functions
        async function loadCourses() {
            showLoading('courses-loading');
            
            try {
                const response = await fetch(`${API_BASE}/courses`);
                const courses = await response.json();
                
                if (response.ok) {
                    displayCourses(courses);
                } else {
                    showError('courses-results', 'Failed to load courses');
                }
            } catch (error) {
                showError('courses-results', 'Network error: ' + error.message);
            } finally {
                hideLoading('courses-loading');
            }
        }

        function displayCourses(courses) {
            const resultsContainer = document.getElementById('courses-results');
            resultsContainer.innerHTML = courses.map(course => `
                <div class="data-card">
                    <h4><span>üìö</span> ${course.title}</h4>
                    <div class="data-item">
                        <span class="data-label">ID:</span>
                        <span class="data-value">${course.id}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Description:</span>
                        <span class="data-value">${course.description || 'None'}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Video:</span>
                        <span class="data-value">${course.video_url ? 'Available' : 'None'}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">PDF:</span>
                        <span class="data-value">${course.pdf_url ? 'Available' : 'None'}</span>
                    </div>
                </div>
            `).join('');
        }

        // Toggle functions for video and PDF inputs
        function toggleVideoInput(source) {
            const urlGroup = document.getElementById('video-url-group');
            const fileGroup = document.getElementById('video-file-group');
            
            if (source === 'url') {
                urlGroup.style.display = 'block';
                fileGroup.style.display = 'none';
            } else {
                urlGroup.style.display = 'none';
                fileGroup.style.display = 'block';
            }
        }

        function togglePdfInput(source) {
            const urlGroup = document.getElementById('pdf-url-group');
            const fileGroup = document.getElementById('pdf-file-group');
            
            if (source === 'url') {
                urlGroup.style.display = 'block';
                fileGroup.style.display = 'none';
            } else if (source === 'file') {
                urlGroup.style.display = 'none';
                fileGroup.style.display = 'block';
            } else {
                urlGroup.style.display = 'none';
                fileGroup.style.display = 'none';
            }
        }

        async function createCourse() {
            const title = document.getElementById('course-title').value.trim();
            const description = document.getElementById('course-description').value.trim();
            
            if (!title) {
                showError('courses-results', 'Course title is required');
                return;
            }
            
            // Get video source
            const videoSource = document.querySelector('input[name="video-source"]:checked').value;
            const pdfSource = document.querySelector('input[name="pdf-source"]:checked').value;
            
            // Validate video input
            let videoData = null;
            if (videoSource === 'url') {
                const videoUrl = document.getElementById('course-video').value.trim();
                if (!videoUrl) {
                    showError('courses-results', 'Video URL is required when using URL option');
                    return;
                }
                videoData = videoUrl;
            } else {
                const videoFile = document.getElementById('course-video-file').files[0];
                if (!videoFile) {
                    showError('courses-results', 'Video file is required when using file upload option');
                    return;
                }
                // Check file size (100MB limit)
                if (videoFile.size > 100 * 1024 * 1024) {
                    showError('courses-results', 'Video file size must be less than 100MB');
                    return;
                }
                videoData = videoFile;
            }
            
            // Validate PDF input
            let pdfData = null;
            if (pdfSource === 'url') {
                const pdfUrl = document.getElementById('course-pdf').value.trim();
                if (!pdfUrl) {
                    showError('courses-results', 'PDF URL is required when using URL option');
                    return;
                }
                pdfData = pdfUrl;
            } else if (pdfSource === 'file') {
                const pdfFile = document.getElementById('course-pdf-file').files[0];
                if (!pdfFile) {
                    showError('courses-results', 'PDF file is required when using file upload option');
                    return;
                }
                // Check file size (50MB limit)
                if (pdfFile.size > 50 * 1024 * 1024) {
                    showError('courses-results', 'PDF file size must be less than 50MB');
                    return;
                }
                pdfData = pdfFile;
            }
            
            showLoading('courses-loading');
            
            try {
                // Check if we need to upload files
                if (videoSource === 'file' || pdfSource === 'file') {
                    // Use FormData for file uploads
                    const formData = new FormData();
                    formData.append('title', title);
                    formData.append('description', description);
                    
                    if (videoSource === 'file') {
                        formData.append('video_file', videoData);
                    } else {
                        formData.append('video_url', videoData);
                    }
                    
                    if (pdfSource === 'file') {
                        formData.append('pdf_file', pdfData);
                    } else if (pdfSource === 'url') {
                        formData.append('pdf_url', pdfData);
                    }
                    
                    const response = await fetch(`${API_BASE}/teacher/courses/create_with_files`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok) {
                        showSuccess('courses-results', `Course created successfully! ID: ${data.id}`);
                        clearCourseForm();
                    } else {
                        showError('courses-results', data.detail || 'Failed to create course');
                    }
                } else {
                    // Use JSON for URL-only submission
                    const courseData = {
                        title: title,
                        description: description,
                        video_url: videoData,
                        pdf_url: pdfData
                    };
                    
                    const response = await fetch(`${API_BASE}/teacher/courses/create`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(courseData)
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok) {
                        showSuccess('courses-results', `Course created successfully! ID: ${data.id}`);
                        clearCourseForm();
                    } else {
                        showError('courses-results', data.detail || 'Failed to create course');
                    }
                }
            } catch (error) {
                showError('courses-results', 'Network error: ' + error.message);
            } finally {
                hideLoading('courses-loading');
            }
        }

        function clearCourseForm() {
            document.getElementById('course-title').value = '';
            document.getElementById('course-description').value = '';
            document.getElementById('course-video').value = '';
            document.getElementById('course-pdf').value = '';
            document.getElementById('course-video-file').value = '';
            document.getElementById('course-pdf-file').value = '';
            
            // Reset radio buttons to default
            document.querySelector('input[name="video-source"][value="url"]').checked = true;
            document.querySelector('input[name="pdf-source"][value="url"]').checked = true;
            
            // Reset input visibility
            toggleVideoInput('url');
            togglePdfInput('url');
        }

        async function enrollStudent() {
            const studentId = document.getElementById('enroll-student-id').value;
            const courseId = document.getElementById('enroll-course-id').value;
            
            showLoading('courses-loading');
            
            try {
                const response = await fetch(`${API_BASE}/students/${studentId}/start_course/${courseId}`, {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showSuccess('courses-results', data.message);
                } else {
                    showError('courses-results', data.detail || 'Failed to enroll student');
                }
            } catch (error) {
                showError('courses-results', 'Network error: ' + error.message);
            } finally {
                hideLoading('courses-loading');
            }
        }

        // Learning Functions
        async function startCamera() {
            try {
                currentStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { width: 640, height: 480 } 
                });
                document.getElementById('video-feed').srcObject = currentStream;
                showSuccess('learning-results', 'Camera started successfully!');
            } catch (error) {
                showError('learning-results', 'Failed to access camera: ' + error.message);
            }
        }

        function stopCamera() {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
                document.getElementById('video-feed').srcObject = null;
                currentStream = null;
                
                if (autoTrackingInterval) {
                    clearInterval(autoTrackingInterval);
                    autoTrackingInterval = null;
                }
                
                showSuccess('learning-results', 'Camera stopped');
            }
        }

        async function analyzeFrame() {
            if (!currentStream) {
                showError('learning-results', 'Please start camera first');
                return;
            }
            await analyzeCurrentFrame();
        }

        async function analyzeCurrentFrame() {
            if (!currentStream) {
                showError('learning-results', 'Please start camera first');
                return;
            }

            const video = document.getElementById('video-feed');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0);
            
            const imageData = canvas.toDataURL('image/jpeg').split(',')[1];
            const studentId = document.getElementById('analysis-student-id').value;
            
            showLoading('learning-loading');
            
            try {
                const response = await fetch(`${API_BASE}/analyze_image`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        image_data: imageData,
                        student_id: parseInt(studentId)
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    displayAnalysisResults(data);
                    updateMetricsChart(data);
                } else {
                    showError('learning-results', data.detail || 'Analysis failed');
                }
            } catch (error) {
                showError('learning-results', 'Network error: ' + error.message);
            } finally {
                hideLoading('learning-loading');
            }
        }

        function toggleAutoTracking() {
            if (autoTrackingInterval) {
                clearInterval(autoTrackingInterval);
                autoTrackingInterval = null;
                showSuccess('learning-results', 'Auto tracking stopped');
            } else {
                if (!currentStream) {
                    showError('learning-results', 'Please start camera first');
                    return;
                }
                
                autoTrackingInterval = setInterval(analyzeCurrentFrame, 3000);
                showSuccess('learning-results', 'Auto tracking started (every 3 seconds)');
            }
        }

        function displayAnalysisResults(data) {
            const resultsContainer = document.getElementById('learning-results');
            resultsContainer.innerHTML = `
                <div class="data-card">
                    <h4><span>üëÅÔ∏è</span> Face Analysis</h4>
                    <div class="data-item">
                        <span class="data-label">Face Detected:</span>
                        <span class="data-value">${data.face_detected ? '‚úÖ Yes' : '‚ùå No'}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Gaze Score:</span>
                        <span class="data-value">${(data.gaze_score * 100).toFixed(1)}%</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Face Attention:</span>
                        <span class="data-value">${(data.face_attention_score * 100).toFixed(1)}%</span>
                    </div>
                </div>
                <div class="data-card">
                    <h4><span>üß†</span> Cognitive Analysis</h4>
                    <div class="data-item">
                        <span class="data-label">Cognitive Load:</span>
                        <span class="data-value">${data.cognitive_load.toFixed(1)}%</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Engagement Level:</span>
                        <span class="data-value">${data.engagement_level.toFixed(1)}%</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Emotional State:</span>
                        <span class="data-value">${data.emotional_state}</span>
                    </div>
                </div>
            `;
        }

        function updateMetricsChart(data) {
            metricsData.push({
                timestamp: new Date().toLocaleTimeString(),
                gaze: data.gaze_score * 100,
                attention: data.face_attention_score * 100,
                cognitive: data.cognitive_load,
                engagement: data.engagement_level
            });
            
            // Keep only last 20 data points
            if (metricsData.length > 20) {
                metricsData.shift();
            }
            
            drawMetricsChart();
            drawCognitiveChart();
        }

        function drawMetricsChart() {
            const canvas = document.getElementById('metrics-chart');
            const ctx = canvas.getContext('2d');
            
            // Simple line chart implementation
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            metricsData.forEach((data, index) => {
                const x = (index / (metricsData.length - 1)) * canvas.width;
                const y = canvas.height - (data.gaze / 100) * canvas.height;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            
            ctx.stroke();
        }

        function drawCognitiveChart() {
            const canvas = document.getElementById('cognitive-chart');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#f5576c';
            
            const latestData = metricsData[metricsData.length - 1];
            if (latestData) {
                const barHeight = (latestData.cognitive / 100) * canvas.height;
                ctx.fillRect(0, canvas.height - barHeight, canvas.width, barHeight);
            }
        }

        // Notes Functions
        async function uploadNote() {
            const studentId = document.getElementById('notes-student-id').value;
            const fileInput = document.getElementById('note-file');
            const file = fileInput.files[0];
            
            if (!file) {
                showError('notes-results', 'Please select a file');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', file);
            
            showLoading('notes-loading');
            
            try {
                const response = await fetch(`${API_BASE}/students/${studentId}/upload_notes`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showSuccess('notes-results', `Note uploaded! Summary: ${data.summary.substring(0, 100)}...`);
                    fileInput.value = '';
                } else {
                    showError('notes-results', data.detail || 'Upload failed');
                }
            } catch (error) {
                showError('notes-results', 'Network error: ' + error.message);
            } finally {
                hideLoading('notes-loading');
            }
        }

        async function loadNotes() {
            const studentId = document.getElementById('view-notes-student-id').value;
            
            showLoading('notes-loading');
            
            try {
                const response = await fetch(`${API_BASE}/students/${studentId}/notes`);
                const notes = await response.json();
                
                if (response.ok) {
                    displayNotes(notes);
                } else {
                    showError('notes-results', 'Failed to load notes');
                }
            } catch (error) {
                showError('notes-results', 'Network error: ' + error.message);
            } finally {
                hideLoading('notes-loading');
            }
        }

        function displayNotes(notes) {
            const resultsContainer = document.getElementById('notes-results');
            
            if (notes.length === 0) {
                resultsContainer.innerHTML = '<div class="data-card"><h4>No notes found</h4></div>';
                return;
            }
            
            resultsContainer.innerHTML = notes.map(note => `
                <div class="data-card">
                    <h4><span>üìÑ</span> Note #${note.id}</h4>
                    <div class="data-item">
                        <span class="data-label">Summary:</span>
                        <span class="data-value">${note.summary || 'No summary'}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">File Path:</span>
                        <span class="data-value">${note.file_path}</span>
                    </div>
                </div>
            `).join('');
        }

        // Chatbot Functions
        async function sendChatMessage() {
            const message = document.getElementById('chat-message').value;
            const context = document.getElementById('chat-context').value;
            
            if (!message) {
                showError('chat-response', 'Please enter a message');
                return;
            }
            
            showLoading('chat-loading');
            
            try {
                const response = await fetch(`${API_BASE}/chatbot`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: message,
                        context: context
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    const responseArea = document.getElementById('chat-response');
                    responseArea.innerHTML = `
                        <strong>You:</strong> ${message}
                        <strong>AI (${data.type}):</strong> ${data.response}
                    `;
                    responseArea.className = 'response-area success';
                    document.getElementById('chat-message').value = '';
                } else {
                    showError('chat-response', data.detail || 'Chatbot error');
                }
            } catch (error) {
                showError('chat-response', 'Network error: ' + error.message);
            } finally {
                hideLoading('chat-loading');
            }
        }

        function sendQuickQuestion(question) {
            document.getElementById('chat-message').value = question;
            sendChatMessage();
        }

        // Teacher Section Navigation
        function showTeacherSection(sectionName) {
            // Hide all teacher sections
            const sections = ['overview', 'courses', 'students', 'analytics', 'settings'];
            sections.forEach(section => {
                const element = document.getElementById(`teacher-${section}`);
                if (element) {
                    element.style.display = 'none';
                }
            });
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show the requested section
            const targetSection = document.getElementById(`teacher-${sectionName}`);
            if (targetSection) {
                targetSection.style.display = 'block';
            }
            
            // Add active class to clicked nav item
            const activeNavItem = document.querySelector(`.nav-item[onclick="showTeacherSection('${sectionName}')"]`);
            if (activeNavItem) {
                activeNavItem.classList.add('active');
            }
        }

        // Teacher Functions
        async function loadAllStudents() {
            showLoading('teacher-loading');
            
            try {
                const response = await fetch(`${API_BASE}/teacher/students`);
                const students = await response.json();
                
                if (response.ok) {
                    displayStudents(students);
                } else {
                    showError('teacher-results', 'Failed to load students');
                }
            } catch (error) {
                showError('teacher-results', 'Network error: ' + error.message);
            } finally {
                hideLoading('teacher-loading');
            }
        }

        function displayStudents(students) {
            const resultsContainer = document.getElementById('teacher-results');
            resultsContainer.innerHTML = students.map(student => `
                <div class="data-card">
                    <h4><span>üë§</span> ${student.name}</h4>
                    <div class="data-item">
                        <span class="data-label">ID:</span>
                        <span class="data-value">${student.id}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Progress:</span>
                        <span class="data-value">${(student.progress * 100).toFixed(1)}%</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Emotional State:</span>
                        <span class="data-value">${student.emotional_state}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Cognitive Limit:</span>
                        <span class="data-value">${student.cognitive_limit}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Current Course:</span>
                        <span class="data-value">${student.current_course_title || 'None'}</span>
                    </div>
                </div>
            `).join('');
        }

        async function loadStudentAnalytics() {
            const studentId = document.getElementById('analytics-student-id').value;
            
            showLoading('teacher-loading');
            
            try {
                const response = await fetch(`${API_BASE}/teacher/students/${studentId}/analytics`);
                const analytics = await response.json();
                
                if (response.ok) {
                    displayAnalytics(analytics);
                    drawTeacherCharts(analytics);
                } else {
                    showError('teacher-results', data.detail || 'Failed to load analytics');
                }
            } catch (error) {
                showError('teacher-results', 'Network error: ' + error.message);
            } finally {
                hideLoading('teacher-loading');
            }
        }

        function displayAnalytics(analytics) {
            const resultsContainer = document.getElementById('teacher-results');
            resultsContainer.innerHTML = `
                <div class="data-card">
                    <h4><span>üìä</span> Analytics for ${analytics.student_name}</h4>
                    <div class="data-item">
                        <span class="data-label">Total Sessions:</span>
                        <span class="data-value">${analytics.total_sessions}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Avg Cognitive Load:</span>
                        <span class="data-value">${analytics.average_cognitive_load.toFixed(1)}%</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Avg Engagement:</span>
                        <span class="data-value">${analytics.average_engagement.toFixed(1)}%</span>
                    </div>
                </div>
                <div class="data-card">
                    <h4><span>üòä</span> Emotional State Distribution</h4>
                    ${Object.entries(analytics.emotional_state_distribution).map(([state, count]) => `
                        <div class="data-item">
                            <span class="data-label">${state}:</span>
                            <span class="data-value">${count}</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function drawTeacherCharts(analytics) {
            // Draw progress chart
            const progressCanvas = document.getElementById('progress-chart');
            const ctx = progressCanvas.getContext('2d');
            ctx.clearRect(0, 0, progressCanvas.width, progressCanvas.height);
            
            // Simple bar chart for progress history
            const barWidth = progressCanvas.width / analytics.progress_history.length;
            analytics.progress_history.forEach((data, index) => {
                const barHeight = data.progress * progressCanvas.height;
                ctx.fillStyle = '#667eea';
                ctx.fillRect(index * barWidth, progressCanvas.height - barHeight, barWidth - 2, barHeight);
            });
            
            // Draw cognitive chart
            const cognitiveCanvas = document.getElementById('teacher-cognitive-chart');
            const cognitiveCtx = cognitiveCanvas.getContext('2d');
            cognitiveCtx.clearRect(0, 0, cognitiveCanvas.width, cognitiveCanvas.height);
            
            // Line chart for cognitive load
            cognitiveCtx.strokeStyle = '#f5576c';
            cognitiveCtx.lineWidth = 2;
            cognitiveCtx.beginPath();
            
            analytics.cognitive_load_history.forEach((load, index) => {
                const x = (index / (analytics.cognitive_load_history.length - 1)) * cognitiveCanvas.width;
                const y = cognitiveCanvas.height - (load / 100) * cognitiveCanvas.height;
                
                if (index === 0) {
                    cognitiveCtx.moveTo(x, y);
                } else {
                    cognitiveCtx.lineTo(x, y);
                }
            });
            
            cognitiveCtx.stroke();
        }

        async function updateStudentSettings() {
            const studentId = document.getElementById('update-student-id').value;
            const cognitiveLimit = parseInt(document.getElementById('cognitive-limit').value);
            const assignedCourseId = parseInt(document.getElementById('assigned-course-id').value);
            
            showLoading('teacher-loading');
            
            try {
                const response = await fetch(`${API_BASE}/teacher/students/${studentId}/update_limits`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        cognitive_limit: cognitiveLimit,
                        assigned_course_id: assignedCourseId
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showSuccess('teacher-results', data.message);
                } else {
                    showError('teacher-results', data.detail || 'Failed to update settings');
                }
            } catch (error) {
                showError('teacher-results', 'Network error: ' + error.message);
            } finally {
                hideLoading('teacher-loading');
            }
        }

        // Utility Functions
        function showLoading(loadingId) {
            document.getElementById(loadingId).style.display = 'block';
        }

        function hideLoading(loadingId) {
            document.getElementById(loadingId).style.display = 'none';
        }

        function showError(containerId, message) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<div class="response-area error">${message}</div>`;
        }

        function showSuccess(containerId, message) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<div class="response-area success">${message}</div>`;
        }

        // Initialize
        window.onload = function() {
            // Load initial data
            loadDashboard();
            loadCourses();
        };

        // Logout function
        function logout() {
            // Clear user session
            localStorage.removeItem('currentUser');
            localStorage.removeItem('user_id');
            localStorage.removeItem('student_id');
            localStorage.removeItem('user_name');
            localStorage.removeItem('user_role');
            
            // Stop camera if running
            if (currentStream) {
                stopCamera();
            }
            
            // Clear any auto-tracking intervals
            if (autoTrackingInterval) {
                clearInterval(autoTrackingInterval);
                autoTrackingInterval = null;
            }
            
            // Redirect to login page
            window.location.href = 'auth.html';
        }
    </script>
</body>
</html>
