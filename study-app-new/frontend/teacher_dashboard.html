<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Dashboard - Smart Learning</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            position: relative;
            overflow-x: hidden;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 20px 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: relative;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .welcome-text {
            text-align: right;
        }

        .welcome-text h2 {
            font-size: 1.2rem;
            color: #333;
            font-weight: 600;
        }

        .welcome-text p {
            color: #666;
            font-size: 0.9rem;
        }

        .logout-btn {
            background: linear-gradient(135deg, #f5576c, #f093fb);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(245, 87, 108, 0.3);
        }

        /* Teacher Navigation Bar */
        .teacher-navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 10px 20px;
            margin: 20px auto 40px;
            max-width: 1400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            overflow-x: auto;
            gap: 15px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 15px 25px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            color: #666;
            font-weight: 500;
            flex: 1;
            text-align: center;
            justify-content: center;
            min-width: 120px;
        }

        .nav-item:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            transform: translateY(-2px);
        }

        .nav-item.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .nav-icon {
            font-size: 1.2rem;
        }

        .nav-label {
            font-size: 0.9rem;
        }

        /* Main container */
        .container {
            max-width: 1400px;
            margin: 40px auto;
            padding: 0 40px;
        }

        /* Teacher Sections */
        .teacher-section {
            display: none;
        }

        .teacher-section:first-child {
            display: block;
        }

        /* Content Sections */
        .content-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .content-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #f5576c);
            background-size: 300% 100%;
            animation: gradientMove 3s ease infinite;
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }

        .section-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .section-header h2 {
            font-size: 2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .section-header p {
            font-size: 1rem;
            color: #666;
            line-height: 1.5;
        }

        /* File editing styles */
        .file-edit-container {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .edit-file-input {
            font-size: 0.8rem;
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .file-info {
            font-size: 0.7rem;
            color: #666;
            font-style: italic;
        }
        
        .btn-save {
            background: #28a745;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 5px;
        }
        
        .btn-save:hover {
            background: #218838;
        }
        
        .btn-cancel {
            background: #6c757d;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .btn-cancel:hover {
            background: #5a6268;
        }

        /* Management Content Styles */
        .management-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .form-card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .form-card h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(240, 147, 251, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #4ade80, #22c55e);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(74, 222, 128, 0.3);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .stat-icon {
            font-size: 2rem;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stat-content .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
        }

        .stat-content .stat-label {
            font-size: 0.9rem;
            color: #666;
        }

        /* Form Grid */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        /* Data Grid */
        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        /* Management Grid */
        .management-grid {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        .grid-table {
            width: 100%;
            border-collapse: collapse;
        }

        .grid-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .grid-table td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            vertical-align: middle;
        }

        .grid-table tr:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        .grid-table tr:last-child td {
            border-bottom: none;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-edit {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: transform 0.2s ease;
        }

        .btn-edit:hover {
            transform: translateY(-2px);
        }

        .btn-delete {
            background: linear-gradient(135deg, #f5576c, #f093fb);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: transform 0.2s ease;
        }

        .btn-delete:hover {
            transform: translateY(-2px);
        }

        .btn-save {
            background: linear-gradient(135deg, #22c55e, #10b981);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: transform 0.2s ease;
        }

        .btn-save:hover {
            transform: translateY(-2px);
        }

        .btn-cancel {
            background: linear-gradient(135deg, #64748b, #475569);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: transform 0.2s ease;
        }

        .btn-cancel:hover {
            transform: translateY(-2px);
        }

        /* Edit Mode */
        .edit-input {
            width: 100%;
            padding: 6px 10px;
            border: 2px solid #667eea;
            border-radius: 6px;
            font-size: 0.9rem;
            background: rgba(255, 255, 255, 0.9);
        }

        .edit-textarea {
            width: 100%;
            padding: 6px 10px;
            border: 2px solid #667eea;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.9);
            resize: vertical;
            min-height: 60px;
        }

        /* Course row cursor in edit mode */
        .course-row.editing {
            cursor: default !important;
        }

        .course-row.editing:hover {
            background-color: transparent !important;
        }
        
        /* Student row cursor in edit mode */
        .student-row.editing {
            cursor: default !important;
        }
        
        .student-row.editing:hover {
            background-color: transparent !important;
        }
        
        /* Dashboard Action Cards */
        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .action-card {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid rgba(0,0,0,0.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .action-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #667eea;
        }
        
        .action-card h3 {
            margin: 10px 0;
            color: #2d3748;
            font-size: 1.1rem;
        }
        
        .action-card p {
            color: #718096;
            font-size: 0.9rem;
            margin: 0;
            line-height: 1.4;
        }
        
        /* Recent Activity */
        .recent-activity {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .recent-activity h3 {
            margin: 0 0 15px 0;
            color: #2d3748;
        }
        
        .activity-feed {
            margin-top: 15px;
        }
        
        .activity-item {
            padding: 12px 0;
            border-bottom: 1px solid #edf2f7;
            display: flex;
            align-items: center;
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-time {
            background: #f7fafc;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            color: #718096;
            margin-right: 15px;
            min-width: 80px;
            text-align: center;
        }
        
        .activity-text {
            color: #4a5568;
            font-size: 0.9rem;
        }
        
        /* Quick Toolbar */
        .quick-toolbar {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            flex-wrap: wrap;
        }
        
        .toolbar-section {
            flex: 1;
            min-width: 200px;
        }
        
        .toolbar-section h4 {
            margin: 0 0 10px 0;
            color: #4a5568;
            font-size: 0.9rem;
        }
        
        .btn-sm {
            padding: 8px 16px;
            font-size: 0.8rem;
            border-radius: 8px;
        }
        
        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .toast {
            background: white;
            border-radius: 10px;
            padding: 15px 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border-left: 4px solid #667eea;
            min-width: 300px;
            max-width: 400px;
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .toast.success {
            border-left-color: #22c55e;
        }
        
        .toast.error {
            border-left-color: #ef4444;
        }
        
        .toast.warning {
            border-left-color: #f59e0b;
        }
        
        .toast.info {
            border-left-color: #3b82f6;
        }
        
        .toast-icon {
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        
        .toast-message {
            flex: 1;
            color: #333;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        .toast-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
        }
        
        .toast-close:hover {
            background-color: #f3f4f6;
            color: #666;
        }

        /* Status Badges */
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-active {
            background: rgba(34, 197, 94, 0.1);
            color: #22c55e;
        }

        .status-inactive {
            background: rgba(245, 87, 108, 0.1);
            color: #f5576c;
        }

        .status-pending {
            background: rgba(251, 191, 36, 0.1);
            color: #fbbf24;
        }

        /* Charts Grid */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .chart-card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .chart-card h4 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.2rem;
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(102, 126, 234, 0.1);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .container {
                padding: 0 20px;
            }

            .teacher-navbar {
                padding: 5px 10px;
                gap: 10px;
            }

            .nav-item {
                padding: 10px 15px;
                font-size: 0.8rem;
                min-width: 100px;
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">üéì</div>
                <h1>Smart Learning</h1>
            </div>
            <div class="user-info">
                <div class="welcome-text">
                    <h2 id="userName">Welcome!</h2>
                    <p>Teacher Dashboard</p>
                </div>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>
    </header>

    <!-- Teacher Navigation Bar -->
    <div class="teacher-navbar">
        <div class="nav-item active" onclick="showTeacherSection('overview')">
            <span class="nav-icon">üìä</span>
            <span class="nav-label">Overview</span>
        </div>
        <div class="nav-item" onclick="showTeacherSection('courses')">
            <span class="nav-icon">üìö</span>
            <span class="nav-label">Course Management</span>
        </div>
        <div class="nav-item" onclick="showTeacherSection('students')">
            <span class="nav-icon">üë•</span>
            <span class="nav-label">Student Management</span>
        </div>
        <div class="nav-item" onclick="showTeacherSection('analytics')">
            <span class="nav-icon">üìà</span>
            <span class="nav-label">Analytics</span>
        </div>
        <div class="nav-item" onclick="showTeacherSection('settings')">
            <span class="nav-icon">‚öôÔ∏è</span>
            <span class="nav-label">Settings</span>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Main Container -->
    <div class="container">
        <!-- Teacher Overview Section -->
        <div class="teacher-section" id="teacher-overview">
            <div class="content-section">
                <div class="section-header">
                    <h2>üë®‚Äçüè´ Teacher Dashboard</h2>
                    <p>Welcome back! Here's your teaching overview</p>
                </div>

                <!-- Quick Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üë•</div>
                        <div class="stat-content">
                            <div class="stat-value" id="total-students">0</div>
                            <div class="stat-label">Total Students</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìö</div>
                        <div class="stat-content">
                            <div class="stat-value" id="active-courses">0</div>
                            <div class="stat-label">Active Courses</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìà</div>
                        <div class="stat-content">
                            <div class="stat-value" id="avg-progress">0%</div>
                            <div class="stat-label">Avg. Progress</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üéØ</div>
                        <div class="stat-content">
                            <div class="stat-value" id="engaged-students">0</div>
                            <div class="stat-label">Engaged Students</div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="action-grid">
                    <div class="action-card" onclick="showTeacherSection('students')">
                        <div class="action-icon">üë•</div>
                        <h3>Manage Students</h3>
                        <p>View, add, or edit student information</p>
                    </div>
                    <div class="action-card" onclick="showTeacherSection('courses')">
                        <div class="action-icon">üìö</div>
                        <h3>Course Management</h3>
                        <p>Create and organize course materials</p>
                    </div>
                    <div class="action-card" onclick="showTeacherSection('analytics')">
                        <div class="action-icon">üìä</div>
                        <h3>View Analytics</h3>
                        <p>Track student progress and performance</p>
                    </div>
                    <div class="action-card" onclick="showTeacherSection('settings')">
                        <div class="action-icon">‚öôÔ∏è</div>
                        <h3>Settings</h3>
                        <p>Configure system preferences</p>
                    </div>
                </div>

                <!-- Recent Activity Feed -->
                <div class="recent-activity">
                    <h3>üìã Recent Activity</h3>
                    <div class="activity-feed" id="activity-feed">
                        <div class="activity-item">
                            <span class="activity-time">Loading...</span>
                            <span class="activity-text">Fetching latest activities</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions Toolbar -->
                <div class="quick-toolbar">
                    <div class="toolbar-section">
                        <h4>üìä Quick Analytics</h4>
                        <button class="btn btn-primary btn-sm" onclick="loadQuickAnalytics()">Load Summary</button>
                    </div>
                    <div class="toolbar-section">
                        <h4>üë• Student Actions</h4>
                        <button class="btn btn-secondary btn-sm" onclick="showAddStudentModal()">Add Student</button>
                    </div>
                    <div class="toolbar-section">
                        <h4>üìö Course Actions</h4>
                        <button class="btn btn-success btn-sm" onclick="showAddCourseModal()">Create Course</button>
                    </div>
                </div>

                <div class="data-grid" id="teacher-results">
                    <!-- Teacher data will be loaded here -->
                </div>

                <div class="loading" id="teacher-loading">
                    <div class="spinner"></div>
                    <p>Loading teacher data...</p>
                </div>
            </div>
        </div>

        <!-- Teacher Course Management Section -->
        <div class="teacher-section" id="teacher-courses" style="display: none;">
            <div class="content-section">
                <div class="section-header">
                    <h2>üìö Course Management</h2>
                    <p>Create, edit, and organize courses</p>
                </div>
                <div class="management-content">
                    <div class="form-card">
                        <h3>Create New Course</h3>
                        <div class="form-group">
                            <label>Course Title:</label>
                            <input type="text" id="courseTitle" placeholder="Enter course title">
                        </div>
                        <div class="form-group">
                            <label>Description:</label>
                            <textarea id="courseDescription" placeholder="Enter course description"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Video File:</label>
                            <input type="file" id="courseVideoFile" accept="video/*" onchange="handleVideoFileSelect(this)">
                            <div id="videoFileInfo" style="margin-top: 5px; color: #666; font-size: 0.9rem;"></div>
                        </div>
                        <div class="form-group">
                            <label>PDF File:</label>
                            <input type="file" id="coursePdfFile" accept=".pdf,application/pdf" onchange="handlePdfFileSelect(this)">
                            <div id="pdfFileInfo" style="margin-top: 5px; color: #666; font-size: 0.9rem;"></div>
                        </div>
                        <button class="btn btn-primary" onclick="createCourse()">Create Course</button>
                    </div>
                </div>
                
                <!-- Courses Management Grid -->
                <div class="management-grid" id="coursesManagementGrid" style="display: none;">
                    <table class="grid-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Title</th>
                                <th>Description</th>
                                <th>Video URL</th>
                                <th>PDF URL</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="coursesTableBody">
                            <!-- Courses will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Teacher Student Management Section -->
        <div class="teacher-section" id="teacher-students" style="display: none;">
            <div class="content-section">
                <div class="section-header">
                    <h2>üë• Student Management</h2>
                    <p>Click on any student row to view detailed analytics and information</p>
                </div>
                
                <!-- Students Management Grid -->
                <div class="management-grid" id="studentsManagementGrid" style="display: none;">
                    <table class="grid-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Progress</th>
                                <th>Current Course</th>
                                <th>Emotional State</th>
                                <th>Cognitive Limit</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="studentsTableBody">
                            <!-- Students will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Teacher Analytics Section -->
        <div class="teacher-section" id="teacher-analytics" style="display: none;">
            <div class="content-section">
                <div class="section-header">
                    <h2>üìà Analytics & Insights</h2>
                    <p>View learning analytics and patterns</p>
                </div>
                <div class="management-content">
                    <div class="form-card">
                        <h3>Student Progress Analytics</h3>
                        <div id="analyticsData"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Teacher Settings Section -->
        <div class="teacher-section" id="teacher-settings" style="display: none;">
            <div class="content-section">
                <div class="section-header">
                    <h2>‚öôÔ∏è Settings</h2>
                    <p>Configure system settings</p>
                </div>
                <div class="management-content">
                    <div class="form-card">
                        <h3>System Configuration</h3>
                        <div class="form-group">
                            <label>Max Students per Course:</label>
                            <input type="number" id="maxStudents" value="50">
                        </div>
                        <div class="form-group">
                            <label>Default Course Duration (hours):</label>
                            <input type="number" id="courseDuration" value="40">
                        </div>
                        <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        let userId = null;
        let userName = null;

        // Initialize
        window.onload = function() {
            // Get user info from URL parameters or localStorage
            const urlParams = new URLSearchParams(window.location.search);
            userId = urlParams.get('user_id') || localStorage.getItem('user_id');
            const teacherId = urlParams.get('teacher_id') || localStorage.getItem('teacher_id');
            userName = urlParams.get('user_name') || localStorage.getItem('user_name');

            if (!userId) {
                window.location.href = 'auth.html';
                return;
            }

            // Save to localStorage
            localStorage.setItem('user_id', userId);
            localStorage.setItem('teacher_id', teacherId);
            localStorage.setItem('user_name', userName);
            localStorage.setItem('user_role', 'teacher');

            // Update UI
            document.getElementById('userName').textContent = `Welcome, ${userName}!`;

            // Load dashboard data
            loadDashboardData();
        };
        
        // Toast Notification System
        function showToast(message, type = 'info', duration = 4000) {
            const toastContainer = document.getElementById('toast-container');
            
            // Create toast element
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            // Set icon based on type
            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };
            
            toast.innerHTML = `
                <span class="toast-icon">${icons[type] || icons.info}</span>
                <span class="toast-message">${message}</span>
                <button class="toast-close" onclick="removeToast(this.parentElement)">√ó</button>
            `;
            
            // Add to container
            toastContainer.appendChild(toast);
            
            // Trigger animation
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            // Auto remove after duration
            setTimeout(() => {
                removeToast(toast);
            }, duration);
        }
        
        function removeToast(toast) {
            if (toast && toast.parentElement) {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentElement) {
                        toast.parentElement.removeChild(toast);
                    }
                }, 300);
            }
        }

        // Teacher Section Navigation
        function showTeacherSection(sectionName) {
            console.log('Switching to section:', sectionName);
            
            // Hide all teacher sections
            const sections = ['overview', 'courses', 'students', 'analytics', 'settings'];
            sections.forEach(section => {
                const element = document.getElementById(`teacher-${section}`);
                if (element) {
                    element.style.display = 'none';
                }
            });
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show the requested section
            const targetSection = document.getElementById(`teacher-${sectionName}`);
            if (targetSection) {
                targetSection.style.display = 'block';
                console.log('Section displayed:', sectionName);
                
                // Auto-load dashboard stats when overview tab is opened
                if (sectionName === 'overview') {
                    console.log('Loading dashboard stats automatically...');
                    updateDashboardStats();
                }
                
                // Auto-load students when students tab is opened
                if (sectionName === 'students') {
                    console.log('Loading students automatically...');
                    loadAllStudents();
                }
                
                // Auto-load courses when courses tab is opened
                if (sectionName === 'courses') {
                    console.log('Loading courses automatically...');
                    loadCourses();
                }
                
                // Auto-load analytics when analytics tab is opened
                if (sectionName === 'analytics') {
                    console.log('Loading analytics automatically...');
                    loadAnalytics();
                }
            } else {
                console.error('Section not found:', sectionName);
            }
            
            // Add active class to clicked nav item
            const activeNavItem = document.querySelector(`.nav-item[onclick="showTeacherSection('${sectionName}')"]`);
            if (activeNavItem) {
                activeNavItem.classList.add('active');
            }
        }

        // Load dashboard data
        async function loadDashboardData() {
            document.getElementById('teacher-loading').style.display = 'block';

            try {
                const teacherId = localStorage.getItem('teacher_id');
                if (!teacherId) {
                    console.error('No teacher ID found');
                    return;
                }

                // Load teacher overview data
                const response = await fetch(`${API_BASE}/teacher/dashboard`);
                const data = await response.json();

                if (response.ok) {
                    // Update teacher results with overview data
                    const resultsDiv = document.getElementById('teacher-results');
                    resultsDiv.innerHTML = `
                        <div style="background: rgba(255,255,255,0.9); padding: 20px; border-radius: 10px;">
                            <h4>Teacher Overview</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                <div style="text-align: center; padding: 15px; background: rgba(102,126,234,0.1); border-radius: 8px;">
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #667eea;">${data.total_students || 0}</div>
                                    <div style="font-size: 0.9rem; color: #666;">Total Students</div>
                                </div>
                                <div style="text-align: center; padding: 15px; background: rgba(118,75,162,0.1); border-radius: 8px;">
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #764ba2;">${data.total_courses || 0}</div>
                                    <div style="font-size: 0.9rem; color: #666;">Total Courses</div>
                                </div>
                                <div style="text-align: center; padding: 15px; background: rgba(240,147,251,0.1); border-radius: 8px;">
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #f093fb;">${data.avg_progress || 0}%</div>
                                    <div style="font-size: 0.9rem; color: #666;">Avg Progress</div>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    console.error('Failed to load teacher dashboard');
                }
            } catch (error) {
                console.error('Error loading dashboard:', error);
            } finally {
                document.getElementById('teacher-loading').style.display = 'none';
            }
        }

        // Teacher Functions
        // Enhanced loadAllStudents function with grid display
        async function loadAllStudents() {
            console.log('loadAllStudents called');
            
            const studentsGrid = document.getElementById('studentsManagementGrid');
            const studentsTableBody = document.getElementById('studentsTableBody');
            
            console.log('Elements found:', {
                studentsGrid: !!studentsGrid,
                studentsTableBody: !!studentsTableBody
            });
            
            // Show loading state
            studentsGrid.style.display = 'block';
            studentsTableBody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 20px;">Loading students...</td></tr>';
            
            try {
                console.log('Fetching students...');
                const response = await fetch(`${API_BASE}/teacher/students`);
                const students = await response.json();
                
                console.log('Students response:', {
                    ok: response.ok,
                    count: students.length,
                    data: students
                });
                
                if (response.ok) {
                    if (students.length === 0) {
                        studentsTableBody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 20px;">No students found.</td></tr>';
                    } else {
                        // Display in grid
                        studentsGrid.style.display = 'block';
                        studentsTableBody.innerHTML = students.map(student => `
                            <tr id="student-row-${student.id}" onclick="!this.classList.contains('editing') && showStudentDetailsPopup(${student.id})" style="cursor: pointer; transition: background-color 0.3s;" onmouseover="this.style.backgroundColor='rgba(102,126,234,0.1)'" onmouseout="this.style.backgroundColor='transparent'" class="student-row">
                                <td style="font-weight: 600; color: #667eea;">${student.id}</td>
                                <td class="editable" data-field="name" data-id="${student.id}" style="font-weight: 500;">${student.name || 'Unknown Student'}</td>
                                <td class="editable" data-field="email" data-id="${student.id}">${student.email || 'No email'}</td>
                                <td style="text-align: center;">${((student.progress || 0) * 100).toFixed(1)}%</td>
                                <td class="editable" data-field="current_course_title" data-id="${student.id}">${student.current_course_title || 'Not assigned'}</td>
                                <td class="editable" data-field="emotional_state" data-id="${student.id}"><span class="status-badge ${getEmotionalStateClass(student.emotional_state)}">${student.emotional_state}</span></td>
                                <td class="editable" data-field="cognitive_limit" data-id="${student.id}">${student.cognitive_limit}%</td>
                                <td>
                                    <div class="action-buttons" onclick="event.stopPropagation()">
                                        <button class="btn-edit" onclick="editStudent(${student.id})">‚úèÔ∏è Edit</button>
                                        <button class="btn-delete" onclick="deleteStudent(${student.id})">üóëÔ∏è Delete</button>
                                    </div>
                                </td>
                            </tr>
                        `).join('');
                        
                        console.log('Students loaded successfully');
                    }
                } else {
                    studentsTableBody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 20px; color: red;">‚ùå Failed to load students.</td></tr>';
                }
            } catch (error) {
                console.error('Error loading students:', error);
                studentsTableBody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 20px; color: orange;">‚ö†Ô∏è Error loading students: ' + error.message + '</td></tr>';
            }
        }
        
        // Helper function to get emotional state class
        function getEmotionalStateClass(state) {
            const stateMap = {
                'normal': 'active',
                'happy': 'active', 
                'focused': 'active',
                'confused': 'pending',
                'stressed': 'inactive',
                'bored': 'inactive'
            };
            return stateMap[state.toLowerCase()] || 'active';
        }
        
        // Edit student function
        function editStudent(studentId) {
            console.log('editStudent called for:', studentId);
            
            const row = document.getElementById(`student-row-${studentId}`);
            const editables = row.querySelectorAll('.editable');
            const actionCell = row.querySelector('.action-buttons');
            
            console.log('Edit elements found:', {
                row: !!row,
                editablesCount: editables.length,
                actionCell: !!actionCell,
                isEditing: row.classList.contains('editing')
            });
            
            if (row.classList.contains('editing')) {
                // Save changes
                console.log('Saving student changes...');
                saveStudent(studentId, row);
            } else {
                // Enter edit mode
                console.log('Entering student edit mode...');
                row.classList.add('editing');
                
                editables.forEach(cell => {
                    const field = cell.dataset.field;
                    const value = cell.textContent;
                    
                    console.log('Processing student field:', field, 'value:', value);
                    
                    if (field === 'emotional_state') {
                        cell.innerHTML = `
                            <select class="edit-input" data-field="${field}">
                                <option value="Normal" ${value === 'Normal' ? 'selected' : ''}>Normal</option>
                                <option value="Happy" ${value === 'Happy' ? 'selected' : ''}>Happy</option>
                                <option value="Focused" ${value === 'Focused' ? 'selected' : ''}>Focused</option>
                                <option value="Confused" ${value === 'Confused' ? 'selected' : ''}>Confused</option>
                                <option value="Stressed" ${value === 'Stressed' ? 'selected' : ''}>Stressed</option>
                                <option value="Bored" ${value === 'Bored' ? 'selected' : ''}>Bored</option>
                            </select>
                        `;
                    } else if (field === 'cognitive_limit') {
                        const numericValue = parseInt(value) || 80;
                        cell.innerHTML = `<input type="number" class="edit-input" data-field="${field}" value="${numericValue}" min="0" max="100">`;
                    } else {
                        cell.innerHTML = `<input type="text" class="edit-input" data-field="${field}" value="${value}">`;
                    }
                });
                
                actionCell.innerHTML = `
                    <button class="btn-save" onclick="editStudent(${studentId})">Save</button>
                    <button class="btn-cancel" onclick="cancelEditStudent(${studentId})">Cancel</button>
                `;
                
                console.log('Student edit mode activated');
            }
        }
        
        // Save student changes
        async function saveStudent(studentId, row) {
            const editables = row.querySelectorAll('.edit-input, .edit-textarea');
            const studentData = {};
            
            editables.forEach(input => {
                const field = input.dataset.field;
                if (field === 'cognitive_limit') {
                    studentData[field] = parseInt(input.value);
                } else {
                    studentData[field] = input.value;
                }
            });
            
            try {
                const response = await fetch(`${API_BASE}/teacher/students/${studentId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(studentData)
                });
                
                if (response.ok) {
                    showToast('Student updated successfully!', 'success');
                    loadAllStudents(); // Refresh the grid
                } else {
                    const data = await response.json();
                    showToast('Failed to update student: ' + (data.detail || 'Unknown error'), 'error');
                }
            } catch (error) {
                console.error('Error updating student:', error);
                showToast('Error updating student: ' + error.message, 'error');
            }
        }
        
        // Cancel edit student
        function cancelEditStudent(studentId) {
            loadAllStudents(); // Refresh to cancel edits
        }
        
        // Delete student function
        async function deleteStudent(studentId) {
            if (!confirm('Are you sure you want to delete this student? This action cannot be undone.')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/teacher/students/${studentId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showToast('Student deleted successfully!', 'success');
                    loadAllStudents(); // Refresh the grid
                } else {
                    const data = await response.json();
                    showToast('Failed to delete student: ' + (data.detail || 'Unknown error'), 'error');
                }
            } catch (error) {
                console.error('Error deleting student:', error);
                showToast('Error deleting student: ' + error.message, 'error');
            }
        }

        async function loadStudentAnalytics() {
            const studentId = document.getElementById('analytics-student-id').value;
            const resultsDiv = document.getElementById('teacher-results');
            const analyticsData = document.getElementById('analyticsData');
            
            if (!studentId) {
                showToast('Please enter a student ID', 'warning');
                return;
            }
            
            resultsDiv.innerHTML = '<p>Loading analytics...</p>';
            analyticsData.innerHTML = '<p>Loading analytics...</p>';
            
            try {
                const response = await fetch(`${API_BASE}/teacher/students/${studentId}/analytics`);
                const analytics = await response.json();
                
                if (response.ok) {
                    const analyticsHtml = `
                        <div style="background: rgba(255,255,255,0.9); padding: 20px; border-radius: 10px;">
                            <h4>Analytics for Student ${studentId} - ${analytics.student_name}</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                                <div style="text-align: center; padding: 15px; background: rgba(102,126,234,0.1); border-radius: 8px;">
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #667eea;">${analytics.total_sessions || 0}</div>
                                    <div style="font-size: 0.9rem; color: #666;">Total Sessions</div>
                                </div>
                                <div style="text-align: center; padding: 15px; background: rgba(118,75,162,0.1); border-radius: 8px;">
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #764ba2;">${analytics.average_cognitive_load || 0}%</div>
                                    <div style="font-size: 0.9rem; color: #666;">Avg Cognitive Load</div>
                                </div>
                                <div style="text-align: center; padding: 15px; background: rgba(240,147,251,0.1); border-radius: 8px;">
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #f093fb;">${analytics.average_engagement || 0}%</div>
                                    <div style="font-size: 0.9rem; color: #666;">Avg Engagement</div>
                                </div>
                            </div>
                            <div style="margin-top: 20px;">
                                <h5>Emotional State Distribution:</h5>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                                    ${Object.entries(analytics.emotional_state_distribution || {}).map(([state, count]) => `
                                        <div style="text-align: center; padding: 10px; background: rgba(102,126,234,0.05); border-radius: 5px;">
                                            <div style="font-weight: bold; color: #667eea;">${state}</div>
                                            <div style="font-size: 0.8rem; color: #666;">${count} times</div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    `;
                    
                    resultsDiv.innerHTML = analyticsHtml;
                    analyticsData.innerHTML = analyticsHtml;
                } else {
                    const errorHtml = '<p>Failed to load student analytics.</p>';
                    resultsDiv.innerHTML = errorHtml;
                    analyticsData.innerHTML = errorHtml;
                }
            } catch (error) {
                console.error('Error loading student analytics:', error);
                const errorHtml = '<p>Error loading analytics: ' + error.message + '</p>';
                resultsDiv.innerHTML = errorHtml;
                analyticsData.innerHTML = errorHtml;
            }
        }

        async function updateStudentSettings() {
            const studentId = document.getElementById('update-student-id').value;
            const cognitiveLimit = document.getElementById('cognitive-limit').value;
            const assignedCourseId = document.getElementById('assigned-course-id').value;
            
            if (!studentId) {
                showToast('Please enter a student ID', 'warning');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/teacher/students/${studentId}/settings`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        cognitive_limit: parseInt(cognitiveLimit),
                        assigned_course_id: assignedCourseId ? parseInt(assignedCourseId) : null
                    })
                });
                
                if (response.ok) {
                    showToast('Student settings updated successfully!', 'success');
                    // Reload student data to show updates
                    loadAllStudents();
                } else {
                    const data = await response.json();
                    showToast('Failed to update student settings: ' + (data.detail || 'Unknown error'), 'error');
                }
            } catch (error) {
                console.error('Error updating student settings:', error);
                showToast('Error updating settings: ' + error.message, 'error');
            }
        }

        // File handling functions
        function handleVideoFileSelect(input) {
            const file = input.files[0];
            const fileInfo = document.getElementById('videoFileInfo');
            
            if (file) {
                fileInfo.textContent = `Selected: ${file.name} (${formatFileSize(file.size)})`;
                fileInfo.style.color = '#667eea';
            } else {
                fileInfo.textContent = '';
            }
        }
        
        function handlePdfFileSelect(input) {
            const file = input.files[0];
            const fileInfo = document.getElementById('pdfFileInfo');
            
            if (file) {
                fileInfo.textContent = `Selected: ${file.name} (${formatFileSize(file.size)})`;
                fileInfo.style.color = '#764ba2';
            } else {
                fileInfo.textContent = '';
            }
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function getFileName(url) {
            // Extract filename from URL or path
            const parts = url.split('/');
            const filename = parts[parts.length - 1];
            return filename.length > 20 ? filename.substring(0, 20) + '...' : filename;
        }
        
        // Updated createCourse function with file upload
        async function createCourse() {
            const title = document.getElementById('courseTitle').value;
            const description = document.getElementById('courseDescription').value;
            const videoFile = document.getElementById('courseVideoFile').files[0];
            const pdfFile = document.getElementById('coursePdfFile').files[0];
            
            if (!title) {
                showToast('Please enter a course title', 'warning');
                return;
            }
            
            const formData = new FormData();
            formData.append('title', title);
            formData.append('description', description || '');
            
            if (videoFile) {
                formData.append('video_file', videoFile);
            }
            
            if (pdfFile) {
                formData.append('pdf_file', pdfFile);
            }
            
            try {
                const response = await fetch(`${API_BASE}/teacher/courses/create`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Clear form
                    document.getElementById('courseTitle').value = '';
                    document.getElementById('courseDescription').value = '';
                    document.getElementById('courseVideoFile').value = '';
                    document.getElementById('coursePdfFile').value = '';
                    document.getElementById('videoFileInfo').textContent = '';
                    document.getElementById('pdfFileInfo').textContent = '';
                    
                    console.log('Course created successfully!');
                    
                    // Reload courses
                    loadCourses();
                } else {
                    showToast('Failed to create course: ' + (data.detail || 'Unknown error'), 'error');
                }
            } catch (error) {
                console.error('Error creating course:', error);
                showToast('Error creating course: ' + error.message, 'error');
            }
        }

        // Enhanced loadCourses function with grid display
        async function loadCourses() {
            console.log('loadCourses called');
            
            const coursesGrid = document.getElementById('coursesManagementGrid');
            const coursesTableBody = document.getElementById('coursesTableBody');
            
            console.log('Course elements found:', {
                coursesGrid: !!coursesGrid,
                coursesTableBody: !!coursesTableBody
            });
            
            // Show loading state
            coursesGrid.style.display = 'block';
            coursesTableBody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 20px;">Loading courses...</td></tr>';
            
            try {
                console.log('Fetching courses...');
                const response = await fetch(`${API_BASE}/courses`);
                const courses = await response.json();
                
                console.log('Courses response:', {
                    ok: response.ok,
                    count: courses.length,
                    data: courses
                });
                
                if (response.ok) {
                    if (courses.length === 0) {
                        coursesTableBody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 20px;">No courses found.</td></tr>';
                    } else {
                        // Display in grid
                        coursesGrid.style.display = 'block';
                        coursesTableBody.innerHTML = courses.map(course => `
                            <tr id="course-row-${course.id}" onclick="!this.classList.contains('editing') && showCourseDetailsPopup(${course.id})" style="cursor: pointer; transition: background-color 0.3s;" onmouseover="this.style.backgroundColor='rgba(102,126,234,0.1)'" onmouseout="this.style.backgroundColor='transparent'" class="course-row">
                                <td style="font-weight: 600; color: #667eea;">${course.id}</td>
                                <td class="editable" data-field="title" data-id="${course.id}" style="font-weight: 500;">${course.title || 'Untitled Course'}</td>
                                <td class="editable" data-field="description" data-id="${course.id}" style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${course.description || 'No description available'}</td>
                                <td class="editable" data-field="video_file" data-id="${course.id}">
                                    ${course.video_url ? `<span style="color: #667eea;">üìπ ${getFileName(course.video_url)}</span>` : '<span style="color: #999;">No video</span>'}
                                </td>
                                <td class="editable" data-field="pdf_file" data-id="${course.id}">
                                    ${course.pdf_url ? `<span style="color: #764ba2;">üìÑ ${getFileName(course.pdf_url)}</span>` : '<span style="color: #999;">No PDF</span>'}
                                </td>
                                <td><span class="status-badge status-active">Active</span></td>
                                <td>
                                    <div class="action-buttons" onclick="event.stopPropagation()">
                                        <button class="btn-edit" onclick="editCourse(${course.id})">‚úèÔ∏è Edit</button>
                                        <button class="btn-delete" onclick="deleteCourse(${course.id})">üóëÔ∏è Delete</button>
                                    </div>
                                </td>
                            </tr>
                        `).join('');
                        
                        console.log('Courses loaded successfully');
                    }
                } else {
                    coursesTableBody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 20px; color: red;">‚ùå Failed to load courses.</td></tr>';
                }
            } catch (error) {
                console.error('Error loading courses:', error);
                coursesTableBody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 20px; color: orange;">‚ö†Ô∏è Error loading courses: ' + error.message + '</td></tr>';
            }
        }
        
        // Edit course function
        function editCourse(courseId) {
            console.log('editCourse called for:', courseId);
            
            const row = document.getElementById(`course-row-${courseId}`);
            const editables = row.querySelectorAll('.editable');
            const actionCell = row.querySelector('.action-buttons');
            
            console.log('Edit elements found:', {
                row: !!row,
                editablesCount: editables.length,
                actionCell: !!actionCell,
                isEditing: row.classList.contains('editing')
            });
            
            if (row.classList.contains('editing')) {
                // Save changes
                console.log('Saving course changes...');
                saveCourse(courseId, row);
            } else {
                // Enter edit mode
                console.log('Entering edit mode...');
                row.classList.add('editing');
                
                editables.forEach(cell => {
                    const field = cell.dataset.field;
                    const currentValue = cell.textContent.trim();
                    
                    console.log('Processing field:', field, 'value:', currentValue);
                    
                    if (field === 'description') {
                        cell.innerHTML = `<textarea class="edit-textarea" data-field="${field}">${currentValue}</textarea>`;
                    } else if (field === 'video_file') {
                        cell.innerHTML = `
                            <div class="file-edit-container">
                                <input type="file" id="edit-video-${courseId}" accept="video/*" onchange="handleEditVideoSelect(${courseId}, this)" class="edit-file-input">
                                <div id="edit-video-info-${courseId}" class="file-info">Current: ${currentValue}</div>
                            </div>
                        `;
                    } else if (field === 'pdf_file') {
                        cell.innerHTML = `
                            <div class="file-edit-container">
                                <input type="file" id="edit-pdf-${courseId}" accept=".pdf,.txt" onchange="handleEditPdfSelect(${courseId}, this)" class="edit-file-input">
                                <div id="edit-pdf-info-${courseId}" class="file-info">Current: ${currentValue}</div>
                            </div>
                        `;
                    } else {
                        cell.innerHTML = `<input type="text" class="edit-input" data-field="${field}" value="${currentValue}">`;
                    }
                });
                
                actionCell.innerHTML = `
                    <button class="btn-save" onclick="editCourse(${courseId})">Save</button>
                    <button class="btn-cancel" onclick="cancelEditCourse(${courseId})">Cancel</button>
                `;
                
                console.log('Edit mode activated');
            }
        }
        
        // File handling functions for edit mode
        let editVideoFiles = {};
        let editPdfFiles = {};
        
        function handleEditVideoSelect(courseId, input) {
            const file = input.files[0];
            const infoDiv = document.getElementById(`edit-video-info-${courseId}`);
            
            if (file) {
                editVideoFiles[courseId] = file;
                infoDiv.textContent = `New: ${file.name} (${formatFileSize(file.size)})`;
                infoDiv.style.color = '#667eea';
            } else {
                delete editVideoFiles[courseId];
                infoDiv.textContent = 'Current: No video';
                infoDiv.style.color = '#999';
            }
        }
        
        function handleEditPdfSelect(courseId, input) {
            const file = input.files[0];
            const infoDiv = document.getElementById(`edit-pdf-info-${courseId}`);
            
            if (file) {
                editPdfFiles[courseId] = file;
                infoDiv.textContent = `New: ${file.name} (${formatFileSize(file.size)})`;
                infoDiv.style.color = '#764ba2';
            } else {
                delete editPdfFiles[courseId];
                infoDiv.textContent = 'Current: No PDF';
                infoDiv.style.color = '#999';
            }
        }
        
        // Save course changes
        async function saveCourse(courseId, row) {
            const courseData = {};
            
            // Get text inputs
            const textInputs = row.querySelectorAll('.edit-input');
            textInputs.forEach(input => {
                const field = input.dataset.field;
                courseData[field] = input.value;
            });
            
            // Get textarea
            const textarea = row.querySelector('.edit-textarea');
            if (textarea) {
                courseData[textarea.dataset.field] = textarea.value;
            }
            
            try {
                // Create FormData for file uploads
                const formData = new FormData();
                
                // Add course data
                if (courseData.title) formData.append('title', courseData.title);
                if (courseData.description) formData.append('description', courseData.description);
                
                // Add files if they exist
                if (editVideoFiles[courseId]) {
                    formData.append('video_file', editVideoFiles[courseId]);
                }
                if (editPdfFiles[courseId]) {
                    formData.append('pdf_file', editPdfFiles[courseId]);
                }
                
                const response = await fetch(`${API_BASE}/teacher/courses/${courseId}/edit`, {
                    method: 'PUT',
                    body: formData
                });
                
                if (response.ok) {
                    // Clear edit files
                    delete editVideoFiles[courseId];
                    delete editPdfFiles[courseId];
                    
                    // Reload courses to show updated data
                    loadCourses();
                } else {
                    const error = await response.json();
                    showToast('Failed to save course: ' + (error.detail || 'Unknown error'), 'error');
                }
            } catch (error) {
                console.error('Error saving course:', error);
                showToast('Error saving course: ' + error.message, 'error');
            }
        }
        
        // Cancel edit course
        function cancelEditCourse(courseId) {
            // Clear edit files
            delete editVideoFiles[courseId];
            delete editPdfFiles[courseId];
            
            loadCourses(); // Refresh to cancel edits
        }
        
        // Delete course function
        async function deleteCourse(courseId) {
            if (!confirm('Are you sure you want to delete this course?')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/courses/${courseId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showToast('Course deleted successfully!', 'success');
                    loadCourses(); // Refresh the grid
                } else {
                    const data = await response.json();
                    showToast('Failed to delete course: ' + (data.detail || 'Unknown error'), 'error');
                }
            } catch (error) {
                console.error('Error deleting course:', error);
                showToast('Error deleting course: ' + error.message, 'error');
            }
        }

        async function loadAnalytics() {
            console.log('loadAnalytics called');
            
            const analyticsData = document.getElementById('analyticsData');
            analyticsData.innerHTML = '<p>Loading analytics for all students...</p>';
            
            try {
                console.log('Fetching students for analytics...');
                // Load all students first, then fetch analytics for each
                const response = await fetch(`${API_BASE}/teacher/students`);
                const students = await response.json();
                
                console.log('Students for analytics:', {
                    ok: response.ok,
                    count: students.length,
                    data: students
                });
                
                if (response.ok && students.length > 0) {
                    // Fetch analytics for all students in parallel
                    const analyticsPromises = students.map(async student => {
                        try {
                            const analyticsResponse = await fetch(`${API_BASE}/teacher/students/${student.id}/analytics`);
                            const analytics = analyticsResponse.ok ? await analyticsResponse.json() : null;
                            return { student, analytics, error: !analyticsResponse.ok };
                        } catch (error) {
                            return { student, analytics: null, error: true };
                        }
                    });
                    
                    const results = await Promise.all(analyticsPromises);
                    
                    // Display comprehensive analytics dashboard
                    analyticsData.innerHTML = `
                        <div style="background: rgba(255,255,255,0.9); padding: 20px; border-radius: 10px;">
                            <h4 style="margin: 0 0 20px 0; color: #333; font-size: 1.3rem;">üìä Student-Wise Analytics Dashboard</h4>
                            
                            <!-- Summary Statistics -->
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                                <div style="background: #f0fdf4; padding: 20px; border-radius: 15px; text-align: center; border: 2px solid #10b981;">
                                    <div style="font-size: 2rem; margin-bottom: 10px;">üë•</div>
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #10b981;">${students.length}</div>
                                    <div style="color: #666; font-size: 0.9rem;">Total Students</div>
                                </div>
                                
                                <div style="background: #fef3c7; padding: 20px; border-radius: 15px; text-align: center; border: 2px solid #f59e0b;">
                                    <div style="font-size: 2rem; margin-bottom: 10px;">üìà</div>
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #f59e0b;">${results.filter(r => r.analytics && !r.error).length}</div>
                                    <div style="color: #666; font-size: 0.9rem;">With Analytics</div>
                                </div>
                                
                                <div style="background: #dbeafe; padding: 20px; border-radius: 15px; text-align: center; border: 2px solid #3b82f6;">
                                    <div style="font-size: 2rem; margin-bottom: 10px;">üß†</div>
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #3b82f6;">${(results.reduce((sum, r) => sum + (r.analytics?.average_cognitive_load || 0), 0) / results.filter(r => r.analytics).length || 0).toFixed(1)}%</div>
                                    <div style="color: #666; font-size: 0.9rem;">Avg Cognitive Load</div>
                                </div>
                                
                                <div style="background: #fce7f3; padding: 20px; border-radius: 15px; text-align: center; border: 2px solid #ec4899;">
                                    <div style="font-size: 2rem; margin-bottom: 10px;">üí´</div>
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #ec4899;">${(results.reduce((sum, r) => sum + (r.analytics?.average_engagement || 0), 0) / results.filter(r => r.analytics).length || 0).toFixed(1)}%</div>
                                    <div style="color: #666; font-size: 0.9rem;">Avg Engagement</div>
                                </div>
                            </div>
                            
                            <!-- Individual Student Analytics -->
                            <h5 style="margin: 0 0 15px 0; color: #333; font-size: 1.1rem;">üë®‚Äçüéì Individual Student Analytics</h5>
                            <div style="display: grid; gap: 15px; max-height: 500px; overflow-y: auto;">
                                ${results.map(result => `
                                    <div onclick="showStudentDetailsPopup(${result.student.id})" style="background: #f8fafc; padding: 20px; border-radius: 15px; cursor: pointer; transition: all 0.3s; border-left: 4px solid ${result.error ? '#ef4444' : '#10b981'};" onmouseover="this.style.backgroundColor='rgba(102,126,234,0.1)'" onmouseout="this.style.backgroundColor='#f8fafc'">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                            <div>
                                                <h6 style="margin: 0 0 5px 0; color: #333; font-weight: 600;">${result.student.name}</h6>
                                                <p style="margin: 0; color: #666; font-size: 0.9rem;">ID: ${result.student.id} | ${result.student.email}</p>
                                            </div>
                                            <div style="text-align: right;">
                                                ${result.error ? 
                                                    '<span style="background: #ef4444; color: white; padding: 5px 10px; border-radius: 10px; font-size: 0.8rem;">No Data</span>' :
                                                    '<span style="background: #10b981; color: white; padding: 5px 10px; border-radius: 10px; font-size: 0.8rem;">Data Available</span>'
                                                }
                                            </div>
                                        </div>
                                        
                                        ${result.analytics && !result.error ? `
                                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px;">
                                            <div style="text-align: center; padding: 10px; background: white; border-radius: 8px;">
                                                <div style="font-size: 1.1rem; font-weight: bold; color: #667eea;">${result.analytics.total_sessions || 0}</div>
                                                <div style="color: #666; font-size: 0.7rem;">Sessions</div>
                                            </div>
                                            <div style="text-align: center; padding: 10px; background: white; border-radius: 8px;">
                                                <div style="font-size: 1.1rem; font-weight: bold; color: #f59e0b;">${(result.analytics.average_cognitive_load || 0).toFixed(1)}%</div>
                                                <div style="color: #666; font-size: 0.7rem;">Cognitive Load</div>
                                            </div>
                                            <div style="text-align: center; padding: 10px; background: white; border-radius: 8px;">
                                                <div style="font-size: 1.1rem; font-weight: bold; color: #3b82f6;">${(result.analytics.average_engagement || 0).toFixed(1)}%</div>
                                                <div style="color: #666; font-size: 0.7rem;">Engagement</div>
                                            </div>
                                            <div style="text-align: center; padding: 10px; background: white; border-radius: 8px;">
                                                <div style="font-size: 1.1rem; font-weight: bold; color: #8b5cf6;">${((result.student.progress || 0) * 100).toFixed(1)}%</div>
                                                <div style="color: #666; font-size: 0.7rem;">Progress</div>
                                            </div>
                                        </div>
                                        
                                        ${result.analytics.emotional_state_distribution ? `
                                        <div style="margin-top: 10px;">
                                            <div style="font-size: 0.8rem; color: #666; margin-bottom: 5px;">Emotional States:</div>
                                            <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                                                ${Object.entries(result.analytics.emotional_state_distribution).slice(0, 3).map(([state, count]) => `
                                                    <span style="background: rgba(102,126,234,0.1); color: #667eea; padding: 3px 8px; border-radius: 12px; font-size: 0.7rem;">${state}: ${count}</span>
                                                `).join('')}
                                                ${Object.keys(result.analytics.emotional_state_distribution).length > 3 ? '<span style="color: #666; font-size: 0.7rem;">...</span>' : ''}
                                            </div>
                                        </div>
                                        ` : ''}
                                        ` : '<p style="margin: 0; color: #999; font-size: 0.9rem; font-style: italic;">No analytics data available for this student.</p>'}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    
                    console.log('Analytics loaded successfully for all students');
                } else {
                    analyticsData.innerHTML = '<div style="background: #f8fafc; padding: 20px; border-radius: 10px; text-align: center; color: #666;">No students available for analytics.</div>';
                }
            } catch (error) {
                console.error('Error loading analytics:', error);
                analyticsData.innerHTML = '<div style="background: #fef2f2; padding: 20px; border-radius: 10px; text-align: center; color: #ef4444;">Error loading analytics: ' + error.message + '</div>';
            }
        }

        async function saveSettings() {
            const maxStudents = document.getElementById('maxStudents').value;
            const courseDuration = document.getElementById('courseDuration').value;
            
            try {
                const response = await fetch(`${API_BASE}/teacher/settings`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        max_students_per_course: parseInt(maxStudents),
                        default_course_duration: parseInt(courseDuration)
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    showToast(`Settings saved successfully!\nMax Students: ${maxStudents}\nCourse Duration: ${courseDuration} hours`, 'success');
                } else {
                    const data = await response.json();
                    showToast(`Settings configuration ready:\nMax Students: ${maxStudents}\nCourse Duration: ${courseDuration} hours\n\n(Backend endpoint will be implemented)`, 'info');
                }
            } catch (error) {
                console.error('Error saving settings:', error);
                showToast(`Settings configuration ready:\nMax Students: ${maxStudents}\nCourse Duration: ${courseDuration} hours\n\n(Backend endpoint will be implemented)`, 'info');
            }
        }

        // Show comprehensive student details popup
        async function showStudentDetailsPopup(studentId) {
            console.log('Loading student details for:', studentId);
            
            // Show loading popup
            showLoadingPopup('Loading student details...');
            
            try {
                // Fetch student data, analytics, and courses with progress in parallel
                const [studentResponse, analyticsResponse, coursesResponse] = await Promise.all([
                    fetch(`${API_BASE}/teacher/students`),
                    fetch(`${API_BASE}/teacher/students/${studentId}/analytics`),
                    fetch(`${API_BASE}/students/${studentId}/courses_with_progress`)
                ]);
                
                const students = await studentResponse.json();
                const analytics = analyticsResponse.ok ? await analyticsResponse.json() : null;
                const coursesWithProgress = coursesResponse.ok ? await coursesResponse.json() : [];
                
                // Find the specific student
                const student = students.find(s => s.id === studentId);
                if (!student) {
                    throw new Error('Student not found');
                }
                
                hideLoadingPopup();
                showStudentDetailsPopupContent(student, analytics, coursesWithProgress);
                
            } catch (error) {
                console.error('Error loading student details:', error);
                hideLoadingPopup();
                showToast('Error loading student details: ' + error.message, 'error');
            }
        }
        
        // Show loading popup
        function showLoadingPopup(message) {
            const popup = document.createElement('div');
            popup.id = 'loadingPopup';
            popup.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center;
                z-index: 1000; backdrop-filter: blur(5px);
            `;
            
            popup.innerHTML = `
                <div style="background: white; padding: 40px; border-radius: 20px; text-align: center; box-shadow: 0 20px 40px rgba(0,0,0,0.3);">
                    <div style="font-size: 3rem; margin-bottom: 20px;">‚è≥</div>
                    <h3 style="margin: 0 0 10px 0; color: #333;">${message}</h3>
                    <p style="margin: 0; color: #666; font-size: 0.9rem;">Please wait...</p>
                </div>
            `;
            
            document.body.appendChild(popup);
        }
        
        // Hide loading popup
        function hideLoadingPopup() {
            const popup = document.getElementById('loadingPopup');
            if (popup) {
                popup.remove();
            }
        }
        
        // Show student details popup content
        function showStudentDetailsPopupContent(student, analytics, coursesWithProgress) {
            const popup = document.createElement('div');
            popup.id = 'studentDetailsPopup';
            popup.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center;
                z-index: 1000; backdrop-filter: blur(5px);
            `;
            
            // Process courses data
            const completedCourses = coursesWithProgress.filter(c => c.progress >= 99.9);
            const inProgressCourses = coursesWithProgress.filter(c => c.progress > 1.0 && c.progress < 99.9);
            const availableCourses = coursesWithProgress.filter(c => c.progress <= 1.0);
            
            // Calculate performance metrics
            const avgCognitiveLoad = analytics ? analytics.average_cognitive_load || 0 : 0;
            const avgEngagement = analytics ? analytics.average_engagement || 0 : 0;
            const totalSessions = analytics ? analytics.total_sessions || 0 : 0;
            
            popup.innerHTML = `
                <div style="background: white; padding: 0; border-radius: 20px; max-width: 900px; width: 95%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 40px rgba(0,0,0,0.3);">
                    <!-- Header -->
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 20px 20px 0 0;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <h2 style="margin: 0 0 10px 0; font-size: 1.8rem;">üë®‚Äçüéì Student Details</h2>
                                <h3 style="margin: 0; font-size: 1.3rem; opacity: 0.9;">${student.name}</h3>
                                <p style="margin: 5px 0 0 0; opacity: 0.8;">ID: ${student.id} | ${student.email}</p>
                            </div>
                            <button onclick="this.closest('#studentDetailsPopup').remove()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 10px 15px; border-radius: 10px; cursor: pointer; font-size: 1.2rem;">‚úï</button>
                        </div>
                    </div>
                    
                    <!-- Content -->
                    <div style="padding: 30px;">
                        <!-- Student Overview -->
                        <div style="margin-bottom: 30px;">
                            <h4 style="margin: 0 0 15px 0; color: #333; font-size: 1.2rem;">üìã Student Overview</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                <div style="background: #f8fafc; padding: 20px; border-radius: 15px; border-left: 4px solid #667eea;">
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #667eea;">${((student.progress || 0) * 100).toFixed(1)}%</div>
                                    <div style="color: #666; font-size: 0.9rem;">Overall Progress</div>
                                </div>
                                <div style="background: #fef3c7; padding: 20px; border-radius: 15px; border-left: 4px solid #f59e0b;">
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #f59e0b;">${student.current_course_title || 'Not assigned'}</div>
                                    <div style="color: #666; font-size: 0.9rem;">Current Course</div>
                                </div>
                                <div style="background: #dbeafe; padding: 20px; border-radius: 15px; border-left: 4px solid #3b82f6;">
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #3b82f6;">${student.emotional_state}</div>
                                    <div style="color: #666; font-size: 0.9rem;">Emotional State</div>
                                </div>
                                <div style="background: #fce7f3; padding: 20px; border-radius: 15px; border-left: 4px solid #ec4899;">
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #ec4899;">${student.cognitive_limit}%</div>
                                    <div style="color: #666; font-size: 0.9rem;">Cognitive Limit</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Learning Analytics -->
                        ${analytics ? `
                        <div style="margin-bottom: 30px;">
                            <h4 style="margin: 0 0 15px 0; color: #333; font-size: 1.2rem;">üìä Learning Analytics</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                <div style="background: #f0fdf4; padding: 20px; border-radius: 15px; text-align: center; border: 2px solid #10b981;">
                                    <div style="font-size: 2rem; margin-bottom: 10px;">üéØ</div>
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #10b981;">${totalSessions}</div>
                                    <div style="color: #666; font-size: 0.9rem;">Total Sessions</div>
                                </div>
                                
                                <div style="background: #fef3c7; padding: 20px; border-radius: 15px; text-align: center; border: 2px solid #f59e0b;">
                                    <div style="font-size: 2rem; margin-bottom: 10px;">üß†</div>
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #f59e0b;">${avgCognitiveLoad.toFixed(1)}%</div>
                                    <div style="color: #666; font-size: 0.9rem;">Avg Cognitive Load</div>
                                </div>
                                
                                <div style="background: #dbeafe; padding: 20px; border-radius: 15px; text-align: center; border: 2px solid #3b82f6;">
                                    <div style="font-size: 2rem; margin-bottom: 10px;">üí´</div>
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #3b82f6;">${avgEngagement.toFixed(1)}%</div>
                                    <div style="color: #666; font-size: 0.9rem;">Avg Engagement</div>
                                </div>
                            </div>
                            
                            ${analytics.emotional_state_distribution ? `
                            <div style="margin-top: 20px;">
                                <h5 style="margin: 0 0 10px 0; color: #333;">Emotional State Distribution:</h5>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px;">
                                    ${Object.entries(analytics.emotional_state_distribution).map(([state, count]) => `
                                        <div style="text-align: center; padding: 10px; background: rgba(102,126,234,0.05); border-radius: 8px;">
                                            <div style="font-weight: bold; color: #667eea; font-size: 0.9rem;">${state}</div>
                                            <div style="color: #666; font-size: 0.8rem;">${count} times</div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            ` : ''}
                        </div>
                        ` : ''}
                        
                        <!-- Courses Progress -->
                        <div style="margin-bottom: 30px;">
                            <h4 style="margin: 0 0 15px 0; color: #333; font-size: 1.2rem;">üìö Courses Progress</h4>
                            
                            ${completedCourses.length > 0 ? `
                            <div style="margin-bottom: 20px;">
                                <h5 style="margin: 0 0 10px 0; color: #10b981;">üéì Completed Courses (${completedCourses.length})</h5>
                                <div style="display: grid; gap: 10px;">
                                    ${completedCourses.map(course => `
                                        <div style="background: #f0fdf4; padding: 15px; border-radius: 10px; border-left: 4px solid #10b981;">
                                            <div style="font-weight: 600; color: #10b981;">${course.title}</div>
                                            <div style="color: #666; font-size: 0.9rem;">Progress: ${course.progress.toFixed(1)}% | Time: ${course.time_spent_minutes || 0} min</div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            ` : ''}
                            
                            ${inProgressCourses.length > 0 ? `
                            <div style="margin-bottom: 20px;">
                                <h5 style="margin: 0 0 10px 0; color: #f59e0b;">üìö In Progress Courses (${inProgressCourses.length})</h5>
                                <div style="display: grid; gap: 10px;">
                                    ${inProgressCourses.map(course => `
                                        <div style="background: #fef3c7; padding: 15px; border-radius: 10px; border-left: 4px solid #f59e0b;">
                                            <div style="font-weight: 600; color: #f59e0b;">${course.title}</div>
                                            <div style="color: #666; font-size: 0.9rem;">Progress: ${course.progress.toFixed(1)}% | Time: ${course.time_spent_minutes || 0} min</div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            ` : ''}
                            
                            ${availableCourses.length > 0 ? `
                            <div style="margin-bottom: 20px;">
                                <h5 style="margin: 0 0 10px 0; color: #64748b;">üÜï Available Courses (${availableCourses.length})</h5>
                                <div style="display: grid; gap: 10px;">
                                    ${availableCourses.map(course => `
                                        <div style="background: #f8fafc; padding: 15px; border-radius: 10px; border-left: 4px solid #64748b;">
                                            <div style="font-weight: 600; color: #64748b;">${course.title}</div>
                                            <div style="color: #666; font-size: 0.9rem;">Progress: ${course.progress.toFixed(1)}% | Not started</div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            ` : ''}
                            
                            ${coursesWithProgress.length === 0 ? `
                            <div style="background: #f8fafc; padding: 20px; border-radius: 10px; text-align: center; color: #666;">
                                No courses enrolled yet
                            </div>
                            ` : ''}
                        </div>
                        
                        <!-- Action Buttons -->
                        <div style="display: flex; gap: 15px; justify-content: center; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                            <button onclick="editStudent(${student.id})" style="background: #667eea; color: white; border: none; padding: 15px 30px; border-radius: 10px; cursor: pointer; font-size: 1rem; font-weight: 500;">
                                ‚úèÔ∏è Edit Student
                            </button>
                            <button onclick="loadStudentAnalytics()" style="background: #10b981; color: white; border: none; padding: 15px 30px; border-radius: 10px; cursor: pointer; font-size: 1rem; font-weight: 500;">
                                üìä View Analytics
                            </button>
                            <button onclick="this.closest('#studentDetailsPopup').remove()" style="background: #64748b; color: white; border: none; padding: 15px 30px; border-radius: 10px; cursor: pointer; font-size: 1rem; font-weight: 500;">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(popup);
        }

        // Show course details popup
        async function showCourseDetailsPopup(courseId) {
            console.log('Loading course details for:', courseId);
            
            // Show loading popup
            showLoadingPopup('Loading course details...');
            
            try {
                // Fetch course data and enrolled students
                const [courseResponse, enrollmentsResponse] = await Promise.all([
                    fetch(`${API_BASE}/courses/${courseId}`),
                    fetch(`${API_BASE}/courses/${courseId}/enrollments`)
                ]);
                
                const course = await courseResponse.json();
                const enrollments = enrollmentsResponse.ok ? await enrollmentsResponse.json() : [];
                
                if (!courseResponse.ok) {
                    throw new Error('Course not found');
                }
                
                hideLoadingPopup();
                showCourseDetailsPopupContent(course, enrollments);
                
            } catch (error) {
                console.error('Error loading course details:', error);
                hideLoadingPopup();
                showToast('Error loading course details: ' + error.message, 'error');
            }
        }
        
        // Show course details popup content
        function showCourseDetailsPopupContent(course, enrollments) {
            const popup = document.createElement('div');
            popup.id = 'courseDetailsPopup';
            popup.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center;
                z-index: 1000; backdrop-filter: blur(5px);
            `;
            
            // Process enrollments data
            const completedCount = enrollments.filter(e => e.progress >= 99.9).length;
            const inProgressCount = enrollments.filter(e => e.progress > 1.0 && e.progress < 99.9).length;
            const notStartedCount = enrollments.filter(e => e.progress <= 1.0).length;
            
            popup.innerHTML = `
                <div style="background: white; padding: 0; border-radius: 20px; max-width: 900px; width: 95%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 40px rgba(0,0,0,0.3);">
                    <!-- Header -->
                    <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 30px; border-radius: 20px 20px 0 0;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <h2 style="margin: 0 0 10px 0; font-size: 1.8rem;">üìö Course Details</h2>
                                <h3 style="margin: 0; font-size: 1.3rem; opacity: 0.9;">${course.title}</h3>
                                <p style="margin: 5px 0 0 0; opacity: 0.8;">ID: ${course.id}</p>
                            </div>
                            <button onclick="this.closest('#courseDetailsPopup').remove()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 10px 15px; border-radius: 10px; cursor: pointer; font-size: 1.2rem;">‚úï</button>
                        </div>
                    </div>
                    
                    <!-- Content -->
                    <div style="padding: 30px;">
                        <!-- Course Overview -->
                        <div style="margin-bottom: 30px;">
                            <h4 style="margin: 0 0 15px 0; color: #333; font-size: 1.2rem;">üìã Course Overview</h4>
                            <div style="background: #f8fafc; padding: 20px; border-radius: 15px; border-left: 4px solid #10b981; margin-bottom: 15px;">
                                <p style="margin: 0 0 10px 0; color: #333; font-weight: 500;">${course.description || 'No description available'}</p>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 15px;">
                                    <div style="text-align: center; padding: 10px; background: white; border-radius: 8px;">
                                        <div style="font-size: 1.2rem; font-weight: bold; color: #10b981;">${course.difficulty || 'N/A'}</div>
                                        <div style="color: #666; font-size: 0.8rem;">Difficulty</div>
                                    </div>
                                    <div style="text-align: center; padding: 10px; background: white; border-radius: 8px;">
                                        <div style="font-size: 1.2rem; font-weight: bold; color: #3b82f6;">${course.duration || 'N/A'}</div>
                                        <div style="color: #666; font-size: 0.8rem;">Duration</div>
                                    </div>
                                    <div style="text-align: center; padding: 10px; background: white; border-radius: 8px;">
                                        <div style="font-size: 1.2rem; font-weight: bold; color: #8b5cf6;">${enrollments.length}</div>
                                        <div style="color: #666; font-size: 0.8rem;">Total Enrolled</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Course Resources -->
                        <div style="margin-bottom: 30px;">
                            <h4 style="margin: 0 0 15px 0; color: #333; font-size: 1.2rem;">üìÅ Course Resources</h4>
                            <div style="display: grid; gap: 15px;">
                                ${course.video_url ? `
                                <div style="background: #dbeafe; padding: 15px; border-radius: 10px; border-left: 4px solid #3b82f6;">
                                    <div style="font-weight: 600; color: #3b82f6; margin-bottom: 5px;">üìπ Video Resource</div>
                                    <div style="color: #666; font-size: 0.9rem;">${getFileName(course.video_url)}</div>
                                    <div style="color: #667eea; font-size: 0.8rem; margin-top: 5px;">${course.video_url}</div>
                                </div>
                                ` : ''}
                                
                                ${course.pdf_url ? `
                                <div style="background: #fce7f3; padding: 15px; border-radius: 10px; border-left: 4px solid #ec4899;">
                                    <div style="font-weight: 600; color: #ec4899; margin-bottom: 5px;">üìÑ PDF Resource</div>
                                    <div style="color: #666; font-size: 0.9rem;">${getFileName(course.pdf_url)}</div>
                                    <div style="color: #764ba2; font-size: 0.8rem; margin-top: 5px;">${course.pdf_url}</div>
                                </div>
                                ` : ''}
                                
                                ${!course.video_url && !course.pdf_url ? `
                                <div style="background: #f8fafc; padding: 15px; border-radius: 10px; text-align: center; color: #666;">
                                    No resources uploaded yet
                                </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <!-- Student Enrollment Stats -->
                        <div style="margin-bottom: 30px;">
                            <h4 style="margin: 0 0 15px 0; color: #333; font-size: 1.2rem;">üë• Student Enrollment Statistics</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                <div style="background: #f0fdf4; padding: 20px; border-radius: 15px; text-align: center; border: 2px solid #10b981;">
                                    <div style="font-size: 2rem; margin-bottom: 10px;">üéì</div>
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #10b981;">${completedCount}</div>
                                    <div style="color: #666; font-size: 0.9rem;">Completed</div>
                                </div>
                                
                                <div style="background: #fef3c7; padding: 20px; border-radius: 15px; text-align: center; border: 2px solid #f59e0b;">
                                    <div style="font-size: 2rem; margin-bottom: 10px;">üìö</div>
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #f59e0b;">${inProgressCount}</div>
                                    <div style="color: #666; font-size: 0.9rem;">In Progress</div>
                                </div>
                                
                                <div style="background: #f8fafc; padding: 20px; border-radius: 15px; text-align: center; border: 2px solid #64748b;">
                                    <div style="font-size: 2rem; margin-bottom: 10px;">üÜï</div>
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #64748b;">${notStartedCount}</div>
                                    <div style="color: #666; font-size: 0.9rem;">Not Started</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Enrolled Students -->
                        ${enrollments.length > 0 ? `
                        <div style="margin-bottom: 30px;">
                            <h4 style="margin: 0 0 15px 0; color: #333; font-size: 1.2rem;">üë®‚Äçüéì Enrolled Students (${enrollments.length})</h4>
                            <div style="display: grid; gap: 10px; max-height: 300px; overflow-y: auto;">
                                ${enrollments.map(enrollment => `
                                    <div style="background: #f8fafc; padding: 15px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <div style="font-weight: 600; color: #333;">${enrollment.student_name || 'Unknown Student'}</div>
                                            <div style="color: #666; font-size: 0.9rem;">ID: ${enrollment.student_id}</div>
                                        </div>
                                        <div style="text-align: right;">
                                            <div style="font-weight: bold; color: #667eea;">${enrollment.progress.toFixed(1)}%</div>
                                            <div style="color: #666; font-size: 0.8rem;">Progress</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}
                        
                        <!-- Action Buttons -->
                        <div style="display: flex; gap: 15px; justify-content: center; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                            <button onclick="editCourse(${course.id})" style="background: #667eea; color: white; border: none; padding: 15px 30px; border-radius: 10px; cursor: pointer; font-size: 1rem; font-weight: 500;">
                                ‚úèÔ∏è Edit Course
                            </button>
                            <button onclick="this.closest('#courseDetailsPopup').remove()" style="background: #64748b; color: white; border: none; padding: 15px 30px; border-radius: 10px; cursor: pointer; font-size: 1rem; font-weight: 500;">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(popup);
        }

        // Logout
        function logout() {
            localStorage.clear();
            window.location.href = 'auth.html';
        }
        
        // Dashboard Functions
        async function updateDashboardStats() {
            console.log('Updating dashboard stats...');
            
            try {
                // Use the new dashboard analytics endpoint
                const response = await fetch(`${API_BASE}/teacher/dashboard/analytics`);
                const analytics = await response.json();
                
                if (response.ok) {
                    // Update stats with real analytics data
                    document.getElementById('total-students').textContent = analytics.total_students || 0;
                    document.getElementById('active-courses').textContent = analytics.total_courses || 0;
                    document.getElementById('avg-progress').textContent = `${(analytics.average_progress || 0).toFixed(1)}%`;
                    document.getElementById('engaged-students').textContent = analytics.engaged_students || 0;
                    
                    // Update activity feed with real data
                    updateActivityFeedWithAnalytics(analytics);
                    
                    console.log('Dashboard stats updated successfully:', analytics);
                } else {
                    throw new Error('Failed to fetch analytics');
                }
                
            } catch (error) {
                console.error('Error updating dashboard stats:', error);
                
                // Fallback: Try to get basic data from existing endpoints
                try {
                    const studentsRes = await fetch(`${API_BASE}/teacher/students`);
                    const students = await studentsRes.json();
                    
                    const coursesRes = await fetch(`${API_BASE}/courses`);
                    const courses = await coursesRes.json();
                    
                    // Update with fallback data
                    document.getElementById('total-students').textContent = students.length || 0;
                    document.getElementById('active-courses').textContent = courses.length || 0;
                    
                    const progressSum = students.reduce((sum, student) => sum + (student.progress || 0), 0);
                    const avgProgress = students.length ? (progressSum / students.length) * 100 : 0;
                    document.getElementById('avg-progress').textContent = `${avgProgress.toFixed(1)}%`;
                    
                    const engagedCount = students.filter(student => (student.progress || 0) > 0.5).length;
                    document.getElementById('engaged-students').textContent = engagedCount;
                    
                    updateActivityFeed(students, courses);
                    
                    console.log('Dashboard stats updated with fallback data');
                } catch (fallbackError) {
                    console.error('Fallback also failed:', fallbackError);
                    // Set default values on error
                    document.getElementById('total-students').textContent = '0';
                    document.getElementById('active-courses').textContent = '0';
                    document.getElementById('avg-progress').textContent = '0%';
                    document.getElementById('engaged-students').textContent = '0';
                }
            }
        }
        
        function updateActivityFeedWithAnalytics(analytics) {
            const feed = document.getElementById('activity-feed');
            
            // Clear existing items
            feed.innerHTML = '';
            
            // Add welcome message with real data
            const welcomeItem = document.createElement('div');
            welcomeItem.className = 'activity-item';
            welcomeItem.innerHTML = `
                <span class="activity-time">Just now</span>
                <span class="activity-text">Welcome back! You have ${analytics.total_students} students enrolled in ${analytics.total_courses} courses.</span>
            `;
            feed.appendChild(welcomeItem);
            
            // Add top performers insight
            if (analytics.top_performers > 0) {
                const performersItem = document.createElement('div');
                performersItem.className = 'activity-item';
                performersItem.innerHTML = `
                    <span class="activity-time">Recent</span>
                    <span class="activity-text" style="color: #22c55e;">${analytics.top_performers} students are top performers (>80% progress)!</span>
                `;
                feed.appendChild(performersItem);
            }
            
            // Add students needing attention
            if (analytics.students_need_attention > 0) {
                const attentionItem = document.createElement('div');
                attentionItem.className = 'activity-item';
                attentionItem.innerHTML = `
                    <span class="activity-time">Today</span>
                    <span class="activity-text" style="color: #f59e0b;">${analytics.students_need_attention} students need attention (<30% progress)</span>
                `;
                feed.appendChild(attentionItem);
            }
            
            // Add emotional state insights
            if (analytics.emotional_state_distribution && Object.keys(analytics.emotional_state_distribution).length > 0) {
                const positiveStates = ['happy', 'focused', 'normal'];
                const positiveCount = positiveStates.reduce((sum, state) => 
                    sum + (analytics.emotional_state_distribution[state] || 0), 0
                );
                
                if (positiveCount > 0) {
                    const emotionalItem = document.createElement('div');
                    emotionalItem.className = 'activity-item';
                    emotionalItem.innerHTML = `
                        <span class="activity-time">Today</span>
                        <span class="activity-text" style="color: #10b981;">${positiveCount} students reported positive emotional state</span>
                    `;
                    feed.appendChild(emotionalItem);
                }
            }
            
            // Add recent activity from analytics
            if (analytics.recent_activity && analytics.recent_activity.length > 0) {
                analytics.recent_activity.slice(0, 3).forEach(activity => {
                    const activityItem = document.createElement('div');
                    activityItem.className = 'activity-item';
                    const timeAgo = getTimeAgo(activity.timestamp);
                    activityItem.innerHTML = `
                        <span class="activity-time">${timeAgo}</span>
                        <span class="activity-text">${activity.student_name}: ${activity.details}</span>
                    `;
                    feed.appendChild(activityItem);
                });
            }
            
            // Add cognitive load insight
            if (analytics.average_cognitive_load) {
                const cognitiveItem = document.createElement('div');
                cognitiveItem.className = 'activity-item';
                const cognitiveStatus = analytics.average_cognitive_load > 70 ? 'high' : 
                                      analytics.average_cognitive_load > 40 ? 'moderate' : 'low';
                const cognitiveColor = cognitiveStatus === 'high' ? '#ef4444' : 
                                    cognitiveStatus === 'moderate' ? '#f59e0b' : '#22c55e';
                cognitiveItem.innerHTML = `
                    <span class="activity-time">System</span>
                    <span class="activity-text" style="color: ${cognitiveColor};">Average cognitive load: ${analytics.average_cognitive_load.toFixed(0)}% (${cognitiveStatus})</span>
                `;
                feed.appendChild(cognitiveItem);
            }
            
            // Add system status
            const statusItem = document.createElement('div');
            statusItem.className = 'activity-item';
            statusItem.innerHTML = `
                <span class="activity-time">System</span>
                <span class="activity-text" style="color: #22c55e;">All systems operational</span>
            `;
            feed.appendChild(statusItem);
        }
        
        function getTimeAgo(timestamp) {
            if (!timestamp) return 'Unknown';
            
            const now = new Date();
            const activityTime = new Date(timestamp);
            const diffMs = now - activityTime;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 60) {
                return diffMins <= 1 ? 'Just now' : `${diffMins}m ago`;
            } else if (diffHours < 24) {
                return `${diffHours}h ago`;
            } else if (diffDays < 7) {
                return `${diffDays}d ago`;
            } else {
                return 'Recently';
            }
        }
        
        function updateActivityFeed(students, courses) {
            const feed = document.getElementById('activity-feed');
            
            // Clear existing items
            feed.innerHTML = '';
            
            // Generate activities based on real data
            const activities = [];
            
            // Add welcome message
            activities.push({
                time: 'Just now',
                text: `Welcome back! You have ${students.length} students enrolled in ${courses.length} courses.`
            });
            
            // Add progress insights
            const engagedStudents = students.filter(s => (s.progress || 0) > 0.8);
            if (engagedStudents.length > 0) {
                activities.push({
                    time: 'Recent',
                    text: `${engagedStudents.length} students are making excellent progress (>80%)!`
                });
            }
            
            // Add course activity
            if (courses.length > 0) {
                activities.push({
                    time: 'Today',
                    text: `You have ${courses.length} active courses available.`
                });
            }
            
            // Add student status insights
            const happyStudents = students.filter(s => s.emotional_state && s.emotional_state.toLowerCase().includes('happy'));
            if (happyStudents.length > 0) {
                activities.push({
                    time: 'Today',
                    text: `${happyStudents.length} students reported positive emotional state.`
                });
            }
            
            // Add recent enrollments (simulated)
            if (students.length > 0) {
                const recentEnrollments = students.slice(-3);
                recentEnrollments.forEach(student => {
                    activities.push({
                        time: 'This week',
                        text: `${student.name || 'Student'} enrolled in ${student.current_course_title || 'a course'}`
                    });
                });
            }
            
            // Add activities to feed
            activities.forEach(activity => {
                const item = document.createElement('div');
                item.className = 'activity-item';
                item.innerHTML = `
                    <span class="activity-time">${activity.time}</span>
                    <span class="activity-text">${activity.text}</span>
                `;
                feed.appendChild(item);
            });
            
            // Add system status
            const statusItem = document.createElement('div');
            statusItem.className = 'activity-item';
            statusItem.innerHTML = `
                <span class="activity-time">System</span>
                <span class="activity-text" style="color: #22c55e;">All systems operational</span>
            `;
            feed.appendChild(statusItem);
        }
        
        async function loadQuickAnalytics() {
            console.log('Loading quick analytics...');
            
            try {
                const studentsRes = await fetch(`${API_BASE}/teacher/students`);
                const students = await studentsRes.json();
                
                // Calculate quick analytics
                const analytics = {
                    totalStudents: students.length,
                    avgProgress: students.reduce((sum, s) => sum + (s.progress || 0), 0) / students.length * 100,
                    emotionalStates: students.reduce((states, s) => {
                        const state = s.emotional_state || 'unknown';
                        states[state] = (states[state] || 0) + 1;
                        return states;
                    }, {}),
                    cognitiveLoad: students.reduce((sum, s) => sum + (s.cognitive_limit || 80), 0) / students.length
                };
                
                // Show analytics summary
                const summary = `
üìä Quick Analytics Summary:

üë• Total Students: ${analytics.totalStudents}
üìà Average Progress: ${analytics.avgProgress.toFixed(1)}%
üß† Average Cognitive Load: ${analytics.cognitiveLoad.toFixed(0)}%

Emotional States:
${Object.entries(analytics.emotionalStates).map(([state, count]) => `  ‚Ä¢ ${state}: ${count}`).join('\n')}

Top Performers: ${students.filter(s => (s.progress || 0) > 0.8).length} students
Need Attention: ${students.filter(s => (s.progress || 0) < 0.3).length} students
                `;
                
                // Create a modal for the analytics summary instead of alert
                showAnalyticsModal(summary);
                
            } catch (error) {
                console.error('Error loading quick analytics:', error);
                showToast('Error loading analytics. Please try again.', 'error');
            }
        }
        
        function showAddStudentModal() {
            // Redirect to student management tab with add mode
            showTeacherSection('students');
            setTimeout(() => {
                // Trigger add student functionality
                if (typeof loadAllStudents === 'function') {
                    loadAllStudents();
                    // Show add student form (you can implement this)
                    showToast('Add Student functionality will be available in the Student Management section.', 'info');
                }
            }, 500);
        }
        
        function showAddCourseModal() {
            // Redirect to course management tab with add mode
            showTeacherSection('courses');
            setTimeout(() => {
                // Trigger add course functionality
                if (typeof loadCourses === 'function') {
                    loadCourses();
                    // Show add course form (you can implement this)
                    showToast('Add Course functionality will be available in the Course Management section.', 'info');
                }
            }, 500);
        }
        
        function showAnalyticsModal(summary) {
            // Create modal for analytics summary
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center;
                z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; max-width: 500px; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0; color: #333;">üìä Analytics Summary</h3>
                        <button onclick="this.closest('div[style*=fixed]').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999;">√ó</button>
                    </div>
                    <pre style="white-space: pre-wrap; font-family: inherit; margin: 0; color: #333; line-height: 1.5;">${summary}</pre>
                    <button onclick="this.closest('div[style*=fixed]').remove()" style="margin-top: 20px; padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">Close</button>
                </div>
            `;
            
            modal.onclick = (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            };
            
            document.body.appendChild(modal);
        }
    </script>
</body>
</html>
